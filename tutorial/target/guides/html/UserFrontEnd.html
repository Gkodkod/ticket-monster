<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Marius Bogoevici">
<title>Building The User UI Using HTML5</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Building The User UI Using HTML5</h1>
<div class="details">
<span id="author" class="author">Marius Bogoevici</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_what_will_you_learn_here">What Will You Learn Here?</a></li>
<li><a href="#_first_the_basics">First, the basics</a>
<ul class="sectlevel2">
<li><a href="#_client_side_mvc_support">Client-side MVC Support</a></li>
<li><a href="#_modularity">Modularity</a></li>
<li><a href="#_templating">Templating</a></li>
<li><a href="#_mobile_and_desktop_versions">Mobile and desktop versions</a></li>
</ul>
</li>
<li><a href="#_setting_up_the_structure">Setting up the structure</a>
<ul class="sectlevel2">
<li><a href="#_routing">Routing</a></li>
</ul>
</li>
<li><a href="#_setting_up_the_initial_views">Setting up the initial views</a></li>
<li><a href="#_displaying_events">Displaying Events</a>
<ul class="sectlevel2">
<li><a href="#_the_event_model">The Event model</a></li>
<li><a href="#_the_events_collection">The Events collection</a></li>
<li><a href="#_the_eventsview_view">The EventsView view</a></li>
</ul>
</li>
<li><a href="#_viewing_a_single_event">Viewing a single event</a></li>
<li><a href="#_creating_bookings">Creating Bookings</a></li>
<li><a href="#_mobile_view">Mobile view</a>
<ul class="sectlevel2">
<li><a href="#_setting_up_the_structure_2">Setting up the structure</a></li>
<li><a href="#_the_landing_page">The landing page</a></li>
<li><a href="#_the_events_view">The events view</a></li>
<li><a href="#_displaying_an_individual_event">Displaying an individual event</a></li>
<li><a href="#_booking_tickets">Booking tickets</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_what_will_you_learn_here">What Will You Learn Here?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ve just implemented the business services of our application, and exposed them through RESTful endpoints. Now we need to implement a flexible user interface that can be easily used with both desktop and mobile clients. After reading this tutorial, you will understand our front-end design and the choices that we made in its implementation. Topics covered include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating single-page applications using HTML5, JavaScript and JSON</p>
</li>
<li>
<p>Using JavaScript frameworks for invoking RESTful endpoints and manipulating page content</p>
</li>
<li>
<p>Feature and device detection</p>
</li>
<li>
<p>Implementing a version of the user interface that is optimized for mobile clients using JavaScript frameworks such as jQuery mobile</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The tutorial will show you how to perform all these steps in JBoss Developer Studio, including screenshots that guide you through.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_first_the_basics">First, the basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this tutorial, we will build a single-page application. All the necessary code: HTML, CSS and JavaScript is retrieved within a single page load. Rather than refreshing the page every time the user changes a view, the content of the page will be redrawn by manipulating the DOM in JavaScript. The application uses REST calls to retrieve data from the server.</p>
</div>
<div id="single-page-app_image" class="imageblock">
<div class="content">
<img src="gfx/single-page-app.png" alt="single page app">
</div>
<div class="title">Figure 1. Single page application</div>
</div>
<div class="sect2">
<h3 id="_client_side_mvc_support">Client-side MVC Support</h3>
<div class="paragraph">
<p>Because this is a moderately complex example, which involves multiple views and different types of data, we will use a client-side MVC framework to structure the application, which provides amongst others:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>routing support within the single page application;</p>
</li>
<li>
<p>event-driven interaction between views and data;</p>
</li>
<li>
<p>simplified CRUD invocations on RESTful services.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this application we use the client-side MVC framework "backbone.js".</p>
</div>
<div id="use-of-backbone_image" class="imageblock">
<div class="content">
<img src="gfx/backbone-usage.png" alt="backbone usage">
</div>
<div class="title">Figure 2. Backbone architecture</div>
</div>
</div>
<div class="sect2">
<h3 id="_modularity">Modularity</h3>
<div class="paragraph">
<p>In order to provide good separation of concerns, we split the JavaScript code into modules.  Ensuring that all the modules of the application are loaded properly at runtime becomes a complex task, as the application size increases. To conquer this complexity, we use the Asynchronous Module Definition mechanism as implemented by the "require.js" library.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Asynchronous Module Definition</div>
<div class="paragraph">
<p>The Asynchronous Module Definition (AMD) API specifies a mechanism for defining modules such that the module, and its dependencies, can be asynchronously loaded. This is particularly well suited for the browser where synchronous loading of modules incurs performance, usability, debugging, and cross-domain access problems.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_templating">Templating</h3>
<div class="paragraph">
<p>Instead of manipulating the DOM directly, and mixing up HTML with the JavaScript code, we create HTML markup fragments separately as templates which are applied when the application views are rendered.</p>
</div>
<div class="paragraph">
<p>In this application we use the templating support provided by "underscore.js".</p>
</div>
</div>
<div class="sect2">
<h3 id="_mobile_and_desktop_versions">Mobile and desktop versions</h3>
<div class="paragraph">
<p>The page flow and structure, as well as feature set, are slightly different for mobile and desktop, and therefore we will build two variants of the single-page-application, one for desktop and one for mobile. As the application variants are very similar, we will cover the desktop version of the application first, and then we will explain what is different in the mobile version.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_the_structure">Setting up the structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we start developing the user interface, we need to set up the general application structure and add the JavaScript libraries. First, we create the directory structure:</p>
</div>
<div id="ui-directory-structure" class="imageblock">
<div class="content">
<img src="gfx/ui-file-structure.png" alt="ui file structure">
</div>
<div class="title">Figure 3. File structure for our web application</div>
</div>
<div class="paragraph">
<p>We put stylesheets in <code>resources/css</code> folder, images in <code>resources/img</code>, and HTML view templates in <code>resources/templates</code>. <code>resources/js</code> contains the JavaScript code, split between <code>resources/js/libs</code> - which contains the libraries used by the application, <code>resources/js/app</code> - which contains the application code, and <code>resources/js/configurations</code> which contains module definitions for the different versions of the application - i.e. mobile and desktop. The <code>resources/js/app</code> folder will contain the application modules, in subsequent subdirectories, for models, collections, routers and views.</p>
</div>
<div class="paragraph">
<p>The first step in implementing our solution is adding the stylesheets and JavaScript libraries to the <code>resources/css</code> and <code>resources/js/libs</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">require.js</dt>
<dd>
<p>AMD support, along with the plugin:</p>
<div class="ulist">
<ul>
<li>
<p>text - for loading text files, in our case the HTML templates</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">jQuery</dt>
<dd>
<p>general purpose library for HTML traversal and manipulation</p>
</dd>
<dt class="hdlist1">Underscore</dt>
<dd>
<p>JavaScript utility library (and a dependency of Backbone)</p>
</dd>
<dt class="hdlist1">Backbone</dt>
<dd>
<p>Client-side MVC framework</p>
</dd>
<dt class="hdlist1">Bootstrap</dt>
<dd>
<p>UI components and stylesheets for page structuring</p>
</dd>
<dt class="hdlist1">Modernizr</dt>
<dd>
<p>JavaScript library for HTML5 and CSS3 feature detection</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can copy these libraries (with associated stylesheets) from the project sources. You can also copy the CSS stylesheet in <code>screen.css</code>, since we&#8217;ll include this stylesheet in the HTML. Addtionally, copy the images from the <code>src/main/webapp/resources/img</code> directory in the project sources to the equivalent one in your workspace.</p>
</div>
<div class="paragraph">
<p>Now, we create the main page of the application (which is the URL loaded by the browser):</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/index.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Ticket Monster&lt;/title&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"/&gt;

    &lt;script type="text/javascript" src="resources/js/libs/modernizr-2.8.3.min.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="resources/js/libs/require.js"
            data-main="resources/js/configurations/loader"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the page does not contain much. It loads Modernizr (for HTML5 and CSS3 feature detection) and RequireJS (for loading JavaScript modules in an asynchronous manner). Once RequireJS is loaded by the browser, it will configure itself to use a <code>baseUrl</code> of <code>resources/js/configurations</code> (specified via the <code>data-main</code> attribute on the <code>script</code> tag). All scripts loaded by RequireJS will use this <code>baseUrl</code> unless specified otherwise.</p>
</div>
<div class="paragraph">
<p>RequireJS will then load a script having a module ID of <code>loader</code> (again, specified via the <code>data-main</code> attribute):</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/configurations/loader.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">//detect the appropriate module to load
define(function () {

    /*
     A simple check on the client. For touch devices or small-resolution screens)
     show the mobile client. By enabling the mobile client on a small-resolution screen
     we allow for testing outside a mobile device (like for example the Mobile Browser
     simulator in JBoss Tools and JBoss Developer Studio).
     */

    var environment;

    if (Modernizr.touch || Modernizr.mq("only all and (max-width: 480px)")) {
        environment = "mobile"
    } else {
        environment = "desktop"
    }

    require([environment]);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>This script detects the current client (mobile or desktop) based on its capabilities (touch or not) and loads another JavaScript module (<code>desktop</code> or <code>mobile</code>) defined in the <code>resources/js/configurations</code> folder (aka the <code>baseUrl</code>) depending on the detected features. In the case of the desktop client, the code is loaded from <code>resources/js/configurations/desktop.js</code>.</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/configurations/desktop.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * Shortcut alias definitions - will come in handy when declaring dependencies
 * Also, they allow you to keep the code free of any knowledge about library
 * locations and versions
 */
requirejs.config({
    baseUrl: "resources/js",
    paths: {
        jquery:'libs/jquery-2.0.3',
        underscore:'libs/underscore',
        text:'libs/text',
        bootstrap: 'libs/bootstrap',
        backbone: 'libs/backbone',
        utilities: 'app/utilities',
        router:'app/router/desktop/router'
    },
    // We shim Backbone.js and Underscore.js since they don't declare AMD modules
    shim: {
        'backbone': {
            deps: ['jquery', 'underscore'],
            exports: 'Backbone'
        },

        'underscore': {
            exports: '_'
        }
    }
});

define("initializer", ["jquery"],
    function ($) {
    // Configure jQuery to append timestamps to requests, to bypass browser caches
    // Important for MSIE
    $.ajaxSetup({cache:false});
    $('head').append('&lt;link rel="stylesheet" href="resources/css/bootstrap.css" type="text/css" media="all"/&gt;');
    $('head').append('&lt;link rel="stylesheet" href="resources/css/bootstrap-theme.css" type="text/css" media="all"/&gt;');
    $('head').append('&lt;link rel="stylesheet" href="resources/css/screen.css" type="text/css" media="all"/&gt;');
    $('head').append('&lt;link href="http://fonts.googleapis.com/css?family=Rokkitt" rel="stylesheet" type="text/css"&gt;');
});

// Now we load the dependencies
// This loads and runs the 'initializer' and 'router' modules.
require([
    'initializer',
    'router'
], function(){
});

define("configuration", {
    baseUrl : ""
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The module loads all the utility libraries, converting them to AMD modules where necessary (like it is the case for Backbone). It also defines two modules of its own - an initializer that loads the application stylesheets for the page, and the <code>configuration</code> module that allows customizing the REST service URLs (this will become in handy in a further tutorial).</p>
</div>
<div class="paragraph">
<p>We also define some utility JavaScript functions that are used in the rest of the front-end in a <code>utilities</code> module (also referenced in the <code>desktop</code> module above). For convenience, copy the <code>utilities.js</code> file from the <code>src/main/webapp/resources/js/app/</code> directory in the project sources.</p>
</div>
<div class="paragraph">
<p>Before we add any functionality, let us create a first landing page. We will begin by setting up a critical piece of the application, the router.</p>
</div>
<div class="sect2">
<h3 id="_routing">Routing</h3>
<div class="paragraph">
<p>The router allows for navigation in our application via bookmarkable URLs, and we will define it as follows:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/router/desktop/router.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * A module for the router of the desktop application
 */
define("router", [
    'jquery',
    'underscore',
    'configuration',
    'utilities',
    'text!../templates/desktop/main.html'
],function ($,
            _,
            config,
            utilities,
            MainTemplate) {

    $(document).ready(new function() {
       utilities.applyTemplate($('body'), MainTemplate)
    })

    /**
     * The Router class contains all the routes within the application -
     * i.e. URLs and the actions that will be taken as a result.
     *
     * @type {Router}
     */

    var Router = Backbone.Router.extend({
        initialize: function() {
            //Begin dispatching routes
            Backbone.history.start();
        },
        routes:{
        }
    });

    // Create a router instance
    var router = new Router();

    return router;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember, this is a single page application. You can either navigate using urls such as <code><a href="http://localhost:8080/ticket-monster/index.html#events" class="bare">http://localhost:8080/ticket-monster/index.html#events</a></code> or using relative urls (from within the application, this being exactly what the main menu does). The fragment after the hash sign represents the url within the single page, on which the router will act, according to the mappings set up in the <code>routes</code> property.</p>
</div>
<div class="paragraph">
<p>During the router set up, we load the page template for the entire application. TicketMonster uses a templating library in order to separate application logic from it&#8217;s actual graphical content. The actual HTML is described in template files, which are applied by the application, when necessary, on a DOM element - effectively populating it&#8217;s content. So the general content of the page, as described in the <code>body</code> element is described in a template file too. Let us define it.</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/desktop/main.html</div>
<div class="content">
<pre>&lt;!--
    The main layout of the page - contains the menu and the 'content' &amp;lt;div/&amp;gt; in which all the
    views will render the content.
--&gt;
&lt;div id="logo"&gt;&lt;div class="wrap"&gt;&lt;h1&gt;Ticket Monster&lt;/h1&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div id="container"&gt;
    &lt;div id="menu"&gt;
        &lt;div class="navbar"&gt;
            &lt;!-- Toggle get grouped for better mobile display --&gt;
            &lt;div class="navbar-header"&gt;
                &lt;button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-items"&gt;
                    &lt;span class="sr-only"&gt;Toggle navigation&lt;/span&gt;
                    &lt;span class="icon-bar"&gt;&lt;/span&gt;
                    &lt;span class="icon-bar"&gt;&lt;/span&gt;
                    &lt;span class="icon-bar"&gt;&lt;/span&gt;
                &lt;/button&gt;
            &lt;/div&gt;

            &lt;!-- Collect the nav links, forms, and other content for toggling --&gt;
            &lt;div id="navbar-items" class="collapse navbar-collapse"&gt;
                &lt;ul class="nav navbar-nav"&gt;
                    &lt;li&gt;&lt;a href="#about"&gt;About&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href="#events"&gt;Events&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href="#venues"&gt;Venues&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href="#bookings"&gt;Bookings&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href="#monitor"&gt;Monitor&lt;/a&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;a href="admin"&gt;Administration&lt;/a&gt;&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div id="content" class="container"&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;footer style=""&gt;
    &lt;div style="text-align: center;"&gt;&lt;img src="resources/img/rhjb_eap_logo.png" alt="HTML5"/&gt;&lt;/div&gt;
&lt;/footer&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The actual HTML code of the template contains a menu definition which will be present on all the pages, as well as an empty element named <code>content</code>, which is the placeholder for the application views. When a view is displayed, it will apply a template and populate the <code>content</code> element.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_the_initial_views">Setting up the initial views</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let us complete our application setup by creating an initial landing page. The first thing that we will need to do is to add a view component.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/js/app/views/desktop/home.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * The About view
 */
define([
    'utilities',
    'text!../../../../templates/desktop/home.html'
], function (utilities, HomeTemplate) {

    var HomeView = Backbone.View.extend({
        render:function () {
            utilities.applyTemplate($(this.el),HomeTemplate,{});
            return this;
        }
    });

    return HomeView;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Functionally, this is a very basic component - it only renders the splash page of the application, but it helps us
introduce a new concept that will be heavily used throughout the application views. One main role of a view is to
describe the logic for manipulating the page content. It will do so by defining a function named <code>render</code> which
will be invoked by the application. In this very simple case, all that the view does is to create the content of the splash page.
You can proceed by copying the content of <code>src/main/webapp/resources/templates/desktop/home.html</code> to your project.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Backbone Views</div>
<div class="paragraph">
<p>Views are logical representations of user interface elements that can
interact with data components, such as models in an event-driven fashion.
Apart from defining the logical structure of your user interface, views handle
events resulting from the user interaction (e.g. clicking a DOM element or selecting
an element into a list), translating them into logical actions inside the
application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once we defined a view, we must tell the router to navigate to it whenever requested. We will add the following dependency and mapping to the router:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/router/desktop/router.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * A module for the router of the desktop application
 */
define("router", [
    'jquery',
    'underscore',
    'configuration',
    'utilities',
    'app/views/desktop/home',
    'text!../templates/desktop/main.html'
],function ($,
            _,
            config,
            utilities,
            HomeView,
            MainTemplate) {

    ...
    var Router = Backbone.Router.extend({
        ...
        routes : {
            "":"home",
            "about":"home"
        },
        home : function () {
            utilities.viewManager.showView(new HomeView({el:$("#content")}));
        }
    });
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have just told the router to invoke the <code>home</code> function whenever the user navigates to the root of the application or
uses a <code>#about</code> hash. The method will simply cause the <code>HomeView</code> defined above to render.</p>
</div>
<div class="paragraph">
<p>Now you can navigate to <code><a href="http://localhost:8080/ticket-monster/#about" class="bare">http://localhost:8080/ticket-monster/#about</a></code> or <code><a href="http://localhost:8080/ticket-monster" class="bare">http://localhost:8080/ticket-monster</a></code> and see the results.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_displaying_events">Displaying Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first use case that we implement is event navigation. The users will be able to view the list of events and select the one that they want to attend. After doing so, they will select a venue, and will be able to choose a performance date and time.</p>
</div>
<div class="sect2">
<h3 id="_the_event_model">The Event model</h3>
<div class="paragraph">
<p>We define a Backbone model for holding event data. Nearly all domain entities (booking, event, venue) are represented by a corresponding Backbone model:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/models/event.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * Module for the Event model
 */
define([
    'configuration',
    'backbone'
], function (config) {
    /**
     * The Event model class definition
     * Used for CRUD operations against individual events
     */
    var Event = Backbone.Model.extend({
        urlRoot: config.baseUrl + 'rest/events' // the URL for performing CRUD operations
    });
    // export the Event class
    return Event;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Event</code> model can perform CRUD operations against the REST services we defined earlier.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Backbone Models</div>
<div class="paragraph">
<p>Backbone models contain data as well as much of the logic surrounding
it: conversions, validations, computed properties, and access control.
They also perform CRUD operations with the REST service.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_events_collection">The Events collection</h3>
<div class="paragraph">
<p>We define a Backbone collection for handling groups of events (like the events list):</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/collections/events.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * Module for the Events collection
 */
define([
    // The collection element type and configuration are dependencies
    'app/models/event',
    'configuration'
], function (Event, config) {
    /**
     *  Here we define the Bookings collection
     *  We will use it for CRUD operations on Bookings
     */
    var Events = Backbone.Collection.extend({
        url: config.baseUrl + "rest/events", // the URL for performing CRUD operations
        model: Event,
        id:"id", // the 'id' property of the model is the identifier
        comparator:function (model) {
            return model.get('category').id;
        }
    });
    return Events;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>By mapping the model and collection to a REST endpoint you can perform CRUD operations without having to invoke the services explicitly. You will see how that works a bit later.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Backbone Collections</div>
<div class="paragraph">
<p>Collections are ordered sets of models. They can handle events which are
fired as a result of a change to a individual member, and can perform
CRUD operations for syncing up contents against RESTful services.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_eventsview_view">The EventsView view</h3>
<div class="paragraph">
<p>Now that we have implemented the data components of the example, we need to create the view that displays them.</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/views/desktop/events.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">define([
    'utilities',
    'bootstrap',
    'text!../../../../templates/desktop/events.html'
], function (
    utilities,
    bootstrap,
    eventsTemplate) {

    var EventsView = Backbone.View.extend({
        events:{
            "click a":"update"
        },
        render:function () {
            var categories = _.uniq(
                _.map(this.model.models, function(model){
                    return model.get('category')
                }), false, function(item){
                    return item.id
                });
            utilities.applyTemplate($(this.el), eventsTemplate, {categories:categories, model:this.model})
            $(this.el).find('.item:first').addClass('active');
            $(".carousel").carousel();
            $("a[rel='popover']").popover({trigger:'hover',container:'body'});
            return this;
        },
        update:function () {
            $("a[rel='popover']").popover('hide')
        }
    });

    return  EventsView;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we explained, earlier, the view is attached to a DOM element (the <code>el</code> property). When the <code>render</code> method is invoked, it manipulates the DOM and renders the view. We could have achieved this by writing these instructions directly in the method, but that would make it hard to change the page design later on. Instead, we create a template and apply it, thus separating the HTML view code from the view implementation. Note the dependency on the Bootstrap module - we initialize the Bootstrap carousel and popover components when this view is rendered.</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/desktop/events.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;div class="row"&gt;
    &lt;div class="col-md-3 col-md-offset-1"&gt;
        &lt;div class="panel" id="itemMenu"&gt;

            &lt;%
            _.each(categories, function (category) {
            %&gt;
            &lt;div class="panel panel-default"&gt;
                &lt;div class="panel-heading"&gt;
                    &lt;a class="panel-toggle"
                       data-target="#category-&lt;%=category.id%&gt;-collapsible" data-toggle="collapse"
                       data-parent="#itemMenu"&gt;&lt;%= category.description %&gt;&lt;/a&gt;
                &lt;/div&gt;
                &lt;div id="category-&lt;%=category.id%&gt;-collapsible" class="panel-collapse collapse"&gt;
                    &lt;div id="category-&lt;%- category.id%&gt;" class="panel-body"&gt;

                        &lt;%
                        _.each(model.models, function (model) {
                        if (model.get('category').id == category.id) {
                        %&gt;
                        &lt;p&gt;&lt;a href="#events/&lt;%- model.attributes.id%&gt;" rel="popover"
                              data-content="&lt;%- model.attributes.description%&gt;"
                              data-original-title="&lt;%- model.attributes.name%&gt;"&gt;&lt;%=model.attributes.name%&gt;&lt;/a&gt;&lt;/p&gt;
                        &lt;% }
                        });
                        %&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;% }); %&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;div id='itemSummary' class="col-md-8 hidden-sm hidden-xs"&gt;
        &lt;div class="carousel-container"&gt;
            &lt;div id="eventCarousel" class="carousel slide"&gt;
                &lt;!-- Carousel items --&gt;
                &lt;div class="carousel-inner"&gt;
                    &lt;%_.each(model.models, function(model) {
                        if( model.get('mediaItem')) {
                    %&gt;
                    &lt;div class="item"&gt;
                        &lt;img src='rest/media/&lt;%=model.attributes.mediaItem.id%&gt;'/&gt;

                        &lt;div class="carousel-caption"&gt;
                            &lt;div class="row"&gt;
                                &lt;div class="col-md-9"&gt;
                                    &lt;h4&gt;&lt;%=model.attributes.name%&gt;&lt;/h4&gt;
                                    &lt;p&gt;&lt;%=model.attributes.description%&gt;&lt;/p&gt;
                                &lt;/div&gt;
                                &lt;div class="col-md-2"&gt;
                                    &lt;a class="btn btn-danger action" href="#events/&lt;%=model.id%&gt;"&gt;Book tickets&lt;/a&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;%
                        }
                     });
                    %&gt;
                &lt;/div&gt;
                &lt;!-- Carousel nav --&gt;
                &lt;a class="carousel-control left" href="#eventCarousel" data-slide="prev"&gt;
                    &lt;span class="glyphicon glyphicon-chevron-left"&gt;&lt;/span&gt;
                &lt;/a&gt;
                &lt;a class="carousel-control right" href="#eventCarousel" data-slide="next"&gt;
                    &lt;span class="glyphicon glyphicon-chevron-right"&gt;&lt;/span&gt;
                &lt;/a&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As well as applying the template and preparing the data that will be used to fill it in (the <code>categories</code> and <code>model</code> entries in the map), the <code>render</code> method also performs the JavaScript calls that are required to initialize the UI components (in this case the Bootstrap carousel and popover).</p>
</div>
<div class="paragraph">
<p>A view can also listen to events fired by the children of it&#8217;s root element (<code>el</code>). In this case, the <code>update</code> method is configured to listen to clicks on anchors. The configuration occurs within the <code>events</code> property of the class.</p>
</div>
<div class="paragraph">
<p>Now that the views are in place, we need to add another routing rule to the application.</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/router/desktop/router.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * A module for the router of the desktop application
 */
define("router", [
    ...
    'utilities',
    'app/collections/events',
    'app/views/desktop/home',
    'app/views/desktop/events',
    ...
    'text!../templates/desktop/main.html'
],function ($,
            ...
            utilities,
            Events,
            HomeView,
            EventsView,
            ...
            MainTemplate) {

    var Router = Backbone.Router.extend({
        ...
        routes : {
            ...,
            "events":"events"
        },
        ...,
        events:function () {
            var events = new Events();
            var eventsView = new EventsView({model:events, el:$("#content")});
            events.on("reset",
                function () {
                    utilities.viewManager.showView(eventsView);
                }).fetch({
                    reset : true,
                    error : function() {
                        utilities.displayAlert("Failed to retrieve events from the TicketMonster server.");
                    }
                });
        }
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>events</code> function handles the <code>#events</code> fragment and will retrieve the events in our application via a REST call. We don&#8217;t manually perform the REST call as it is triggered the by invocation of <code>fetch</code> on the <code>Events</code> collection, as discussed earlier.</p>
</div>
<div class="paragraph">
<p>The <code>reset</code> event on the collection is invoked when the data from the server is received, and the collection is populated. This triggers the rendering of the events view (which is bound to the <code>#content</code> div).</p>
</div>
<div class="paragraph">
<p>The whole process is event orientated - the models, views and controllers interact through events.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_viewing_a_single_event">Viewing a single event</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the events list view now in place, we can add a view to display the details of each individual event, allowing the user to select a venue and performance time.</p>
</div>
<div class="paragraph">
<p>We already have the models in place so all we need to do is to create the additional view and expand the router. First, we&#8217;ll implement the view:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/views/desktop/event-detail.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">define([
    'utilities',
    'require',
    'text!../../../../templates/desktop/event-detail.html',
    'text!../../../../templates/desktop/media.html',
    'text!../../../../templates/desktop/event-venue-description.html',
    'configuration',
    'bootstrap'
], function (
    utilities,
    require,
    eventDetailTemplate,
    mediaTemplate,
    eventVenueDescriptionTemplate,
    config,
    Bootstrap) {

    var EventDetail = Backbone.View.extend({

        events:{
            "click input[name='bookButton']":"beginBooking",
            "change select[id='venueSelector']":"refreshShows",
            "change select[id='dayPicker']":"refreshTimes"
        },

        render:function () {
            $(this.el).empty()
            utilities.applyTemplate($(this.el), eventDetailTemplate, this.model.attributes);
            $("#bookingOption").hide();
            $("#venueSelector").attr('disabled', true);
            $("#dayPicker").empty();
            $("#dayPicker").attr('disabled', true)
            $("#performanceTimes").empty();
            $("#performanceTimes").attr('disabled', true)
            var self = this
            $.getJSON(config.baseUrl + "rest/shows?event=" + this.model.get('id'), function (shows) {
                self.shows = shows
                $("#venueSelector").empty().append("&lt;option value='0' selected&gt;Select a venue&lt;/option&gt;");
                $.each(shows, function (i, show) {
                    $("#venueSelector").append("&lt;option value='" + show.id + "'&gt;" + show.venue.address.city + " : " + show.venue.name + "&lt;/option&gt;")
                });
                $("#venueSelector").removeAttr('disabled')
            })
            return this;
        },
        beginBooking:function () {
            require("router").navigate('/book/' + $("#venueSelector option:selected").val() + '/' + $("#performanceTimes").val(), true)
        },
        refreshShows:function (event) {
            event.stopPropagation();
            $("#dayPicker").empty();

            var selectedShowId = event.currentTarget.value;

            if (selectedShowId != 0) {
                var selectedShow = _.find(this.shows, function (show) {
                    return show.id == selectedShowId
                });
                this.selectedShow = selectedShow;
                utilities.applyTemplate($("#eventVenueDescription"), eventVenueDescriptionTemplate, {venue:selectedShow.venue});
                var times = _.uniq(_.sortBy(_.map(selectedShow.performances, function (performance) {
                    return (new Date(performance.date).withoutTimeOfDay()).getTime()
                }), function (item) {
                    return item
                }));
                utilities.applyTemplate($("#venueMedia"), mediaTemplate, selectedShow.venue)
                $("#dayPicker").removeAttr('disabled')
                $("#performanceTimes").removeAttr('disabled')
                _.each(times, function (time) {
                    var date = new Date(time)
                    $("#dayPicker").append("&lt;option value='" + date.toYMD() + "'&gt;" + date.toPrettyStringWithoutTime() + "&lt;/option&gt;")
                });
                this.refreshTimes()
                $("#bookingWhen").show(100)
            } else {
                $("#bookingWhen").hide(100)
                $("#bookingOption").hide()
                $("#dayPicker").empty()
                $("#venueMedia").empty()
                $("#eventVenueDescription").empty()
                $("#dayPicker").attr('disabled', true)
                $("#performanceTimes").empty()
                $("#performanceTimes").attr('disabled', true)
            }

        },
        refreshTimes:function () {
            var selectedDate = $("#dayPicker").val();
            $("#performanceTimes").empty()
            if (selectedDate) {
                $.each(this.selectedShow.performances, function (i, performance) {
                    var performanceDate = new Date(performance.date);
                    if (_.isEqual(performanceDate.toYMD(), selectedDate)) {
                        $("#performanceTimes").append("&lt;option value='" + performance.id + "'&gt;" + performanceDate.getHours().toZeroPaddedString(2) + ":" + performanceDate.getMinutes().toZeroPaddedString(2) + "&lt;/option&gt;")
                    }
                })
            }
            $("#bookingOption").show()
        }

    });

    return  EventDetail;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>This view is more complex than the global events view, as portions of the page need to be updated when the user chooses a venue.</p>
</div>
<div id="ui-event-detail" class="imageblock">
<div class="content">
<img src="gfx/ui-event-details.png" alt="ui event details">
</div>
<div class="title">Figure 4. On the event details page some fragments are re-rendered when the user selects a venue</div>
</div>
<div class="paragraph">
<p>The view responds to three different events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>changing the current venue triggers a reload of the venue details and the venue image, as well as the performance times. The application retrieves the performance times through a REST call.</p>
</li>
<li>
<p>changing the day of the performance causes the performance time selector to reload.</p>
</li>
<li>
<p>once the venue and performance date and time have been selected, the user can navigate to the booking page.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The corresponding templates for the three fragments rendered above are:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/desktop/event-detail.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;div class="row"&gt;
    &lt;h2 class="page-header special-title light-font"&gt;&lt;%=name%&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;div class="row"&gt;
    &lt;div class="col-md-4"&gt;
        &lt;div class="well"&gt;
            &lt;div class="row"&gt;
                &lt;h3 class="page-header col-md-6"&gt;What?&lt;/h3&gt;
                &lt;% if(mediaItem) { %&gt;&lt;img width="100" src='rest/media/&lt;%=mediaItem.id%&gt;'/&gt;&lt;% } %&gt;
            &lt;/div&gt;
            &lt;div class="row top5"&gt;
                &lt;div class="col-md-12"&gt;&lt;%= description %&gt;&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="col-md-4"&gt;
        &lt;div class="well"&gt;
            &lt;div class="row"&gt;
                &lt;h3 class="page-header col-md-6"&gt;Where?&lt;/h3&gt;
                &lt;div class="col-md-6" id='venueMedia'/&gt;
            &lt;/div&gt;
            &lt;div class="row top5"&gt;
                &lt;div class="col-md-12"&gt;
                    &lt;select id="venueSelector" class="form-control"/&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="row top5"&gt;
                &lt;div class="col-md-12"&gt;
                    &lt;div id="eventVenueDescription"/&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div id='bookingWhen' style="display: none;" class="col-md-4"&gt;
        &lt;div class="well"&gt;
            &lt;div class="row"&gt;
                &lt;h3 class="page-header col-md-6"&gt;When?&lt;/h3&gt;
            &lt;/div&gt;

            &lt;div class="row top5"&gt;
                &lt;div class="col-md-12"&gt;
                    &lt;select class="form-control" id="dayPicker"/&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="row top5"&gt;
                &lt;div class="col-md-12"&gt;
                    &lt;select class="form-control" id="performanceTimes"/&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;div id="bookingOption" class="row top5"&gt;
                &lt;div class="col-md-6"&gt;
                    &lt;input name="bookButton" class="btn btn-primary" type="button" value="Order tickets"&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/desktop/event-venue-description.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;address&gt;
    &lt;p&gt;&lt;%= venue.description %&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Address:&lt;/strong&gt;&lt;/p&gt;
    &lt;p&gt;&lt;%= venue.address.street %&gt;&lt;/p&gt;
    &lt;p&gt;&lt;%= venue.address.city %&gt;, &lt;%= venue.address.country %&gt;&lt;/p&gt;
&lt;/address&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/desktop/media.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;%if (mediaItem) { %&gt;&lt;img width="100" src='rest/media/&lt;%=mediaItem.id%&gt;'/&gt;&lt;% } %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that the view exists, we add it to the router:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/router/desktop/router.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * A module for the router of the desktop application
 */
define("router", [
    ...
    'app/models/event',
	...,
    'app/views/desktop/event-detail',
    ...
],function (
			...
            Event,
            ...
            EventDetailView,
            ...) {

    var Router = Backbone.Router.extend({
        ...
        routes:{
            ...
            "events/:id":"eventDetail",
        },
        ...
        eventDetail:function (id) {
            var model = new Event({id:id});
            var eventDetailView = new EventDetailView({model:model, el:$("#content")});
            model.on("change",
                function () {
                    utilities.viewManager.showView(eventDetailView);
                }).fetch({
                    error : function() {
                        utilities.displayAlert("Failed to retrieve the event from the TicketMonster server.");
                    }
                });
        }
    }
    ...
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, this is very similar to the previous view and route, except that now the application can accept parameterized URLs (e.g. <code><a href="http://localhost:8080/ticket-monster/index#events/1" class="bare">http://localhost:8080/ticket-monster/index#events/1</a></code>). This URL can be entered directly into the browser, or it can be navigated to as a relative path (e.g. <code>#events/1</code>) from within the applicaton.</p>
</div>
<div class="paragraph">
<p>With this in place, all that remains is to implement the final view of this use case, creating the bookings.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_bookings">Creating Bookings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The user has chosen the event, the venue and the performance time, and must now create the booking. Users can select one of the available sections for the show&#8217;s venue, and then enter the number of tickets required for each category available for this show (Adult, Child, etc.). They then add the tickets to the current order, which causes the summary view to be updated. Users can also remove tickets from the order. When the order is complete, they enter their contact information (e-mail address) and submit the order to the server.</p>
</div>
<div class="paragraph">
<p>First, we add the new view:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/views/desktop/create-booking.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">define([
    'utilities',
    'require',
    'configuration',
    'text!../../../../templates/desktop/booking-confirmation.html',
    'text!../../../../templates/desktop/create-booking.html',
    'text!../../../../templates/desktop/ticket-categories.html',
    'text!../../../../templates/desktop/ticket-summary-view.html',
    'bootstrap'
],function (
    utilities,
    require,
    config,
    bookingConfirmationTemplate,
    createBookingTemplate,
    ticketEntriesTemplate,
    ticketSummaryViewTemplate){


    var TicketCategoriesView = Backbone.View.extend({
        id:'categoriesView',
        intervalDuration : 100,
        formValues : [],
        events:{
            "change input":"onChange"
        },
        render:function () {
            if (this.model != null) {
                var ticketPrices = _.map(this.model, function (item) {
                    return item.ticketPrice;
                });
                utilities.applyTemplate($(this.el), ticketEntriesTemplate, {ticketPrices:ticketPrices});
            } else {
                $(this.el).empty();
            }
            this.watchForm();
            return this;
        },
        onChange:function (event) {
            var value = event.currentTarget.value;
            var ticketPriceId = $(event.currentTarget).data("tm-id");
            var modifiedModelEntry = _.find(this.model, function (item) {
                return item.ticketPrice.id == ticketPriceId
            });
            // update model
            if ($.isNumeric(value) &amp;&amp; value &gt; 0) {
                modifiedModelEntry.quantity = parseInt(value);
            }
            else {
                delete modifiedModelEntry.quantity;
            }
            // display error messages
            if (value.length &gt; 0 &amp;&amp;
                   (!$.isNumeric(value)  // is a non-number, other than empty string
                        || value &lt;= 0 // is negative
                        || parseFloat(value) != parseInt(value))) { // is not an integer
                $("#error-input-"+ticketPriceId).empty().append("Please enter a positive integer value");
                $("#ticket-category-fieldset-"+ticketPriceId).addClass("error");
            } else {
                $("#error-input-"+ticketPriceId).empty();
                $("#ticket-category-fieldset-"+ticketPriceId).removeClass("error");
            }
            // are there any outstanding errors after this update?
            // if yes, disable the input button
            if (
               $("div[id^='ticket-category-fieldset-']").hasClass("error") ||
                   _.isUndefined(modifiedModelEntry.quantity) ) {
              $("input[name='add']").attr("disabled", true)
            } else {
              $("input[name='add']").removeAttr("disabled")
            }
        },
        watchForm: function() {
            if($("#sectionSelectorPlaceholder").length) {
                var self = this;
                $("input[name*='tickets']").each( function(index,element) {
                    if(element.value !== self.formValues[element.name]) {
                        self.formValues[element.name] = element.value;
                        $("input[name='"+element.name+"']").change();
                    }
                });
                this.timerObject = setTimeout(function() {
                    self.watchForm();
                }, this.intervalDuration);
            } else {
                this.onClose();
            }
        },
        onClose: function() {
            if(this.timerObject) {
                clearTimeout(this.timerObject);
                delete this.timerObject;
            }
        }
    });

    var TicketSummaryView = Backbone.View.extend({
        tagName:'tr',
        events:{
            "click i":"removeEntry"
        },
        render:function () {
            var self = this;
            utilities.applyTemplate($(this.el), ticketSummaryViewTemplate, this.model.bookingRequest);
        },
        removeEntry:function () {
            this.model.bookingRequest.tickets.splice(this.model.index, 1);
        }
    });

    var CreateBookingView = Backbone.View.extend({

        intervalDuration : 100,
        formValues : [],
        events:{
            "click input[name='submit']":"save",
            "change select[id='sectionSelect']":"refreshPrices",
            "keyup #email":"updateEmail",
            "change #email":"updateEmail",
            "click input[name='add']":"addQuantities",
            "click i":"updateQuantities"
        },
        render:function () {

            var self = this;
            $.getJSON(config.baseUrl + "rest/shows/" + this.model.showId, function (selectedShow) {

                self.currentPerformance = _.find(selectedShow.performances, function (item) {
                    return item.id == self.model.performanceId;
                });

                var id = function (item) {return item.id;};
                // prepare a list of sections to populate the dropdown
                var sections = _.uniq(_.sortBy(_.pluck(selectedShow.ticketPrices, 'section'), id), true, id);
                utilities.applyTemplate($(self.el), createBookingTemplate, {
                    sections:sections,
                    show:selectedShow,
                    performance:self.currentPerformance});
                self.ticketCategoriesView = new TicketCategoriesView({model:{}, el:$("#ticketCategoriesViewPlaceholder") });
                self.ticketSummaryView = new TicketSummaryView({model:self.model, el:$("#ticketSummaryView")});
                self.show = selectedShow;
                self.ticketCategoriesView.render();
                self.ticketSummaryView.render();
                $("#sectionSelector").change();
                self.watchForm();
            });
            return this;
        },
        refreshPrices:function (event) {
            var ticketPrices = _.filter(this.show.ticketPrices, function (item) {
                return item.section.id == event.currentTarget.value;
            });
            var sortedTicketPrices = _.sortBy(ticketPrices, function(ticketPrice) {
                return ticketPrice.ticketCategory.description;
            });
            var ticketPriceInputs = new Array();
            _.each(sortedTicketPrices, function (ticketPrice) {
                ticketPriceInputs.push({ticketPrice:ticketPrice});
            });
            this.ticketCategoriesView.model = ticketPriceInputs;
            this.ticketCategoriesView.render();
        },
        save:function (event) {
            var bookingRequest = {ticketRequests:[]};
            var self = this;
            bookingRequest.ticketRequests = _.map(this.model.bookingRequest.tickets, function (ticket) {
                return {ticketPrice:ticket.ticketPrice.id, quantity:ticket.quantity}
            });
            bookingRequest.email = this.model.bookingRequest.email;
            bookingRequest.performance = this.model.performanceId
            $("input[name='submit']").attr("disabled", true)
            $.ajax({url: (config.baseUrl + "rest/bookings"),
                data:JSON.stringify(bookingRequest),
                type:"POST",
                dataType:"json",
                contentType:"application/json",
                success:function (booking) {
                    this.model = {}
                    $.getJSON(config.baseUrl +'rest/shows/performance/' + booking.performance.id, function (retrievedPerformance) {
                        utilities.applyTemplate($(self.el), bookingConfirmationTemplate, {booking:booking, performance:retrievedPerformance })
                    });
                }}).error(function (error) {
                    if (error.status == 400 || error.status == 409) {
                        var errors = $.parseJSON(error.responseText).errors;
                        _.each(errors, function (errorMessage) {
                            $("#request-summary").append('&lt;div class="alert alert-error"&gt;&lt;a class="close" data-dismiss="alert"&gt;×&lt;/a&gt;&lt;strong&gt;Error!&lt;/strong&gt; ' + errorMessage + '&lt;/div&gt;')
                        });
                    } else {
                        $("#request-summary").append('&lt;div class="alert alert-error"&gt;&lt;a class="close" data-dismiss="alert"&gt;×&lt;/a&gt;&lt;strong&gt;Error! &lt;/strong&gt;An error has occured&lt;/div&gt;')
                    }
                    $("input[name='submit']").removeAttr("disabled");
                })

        },
        addQuantities:function () {
            var self = this;
            _.each(this.ticketCategoriesView.model, function (model) {
                if (model.quantity != undefined) {
                    var found = false;
                    _.each(self.model.bookingRequest.tickets, function (ticket) {
                        if (ticket.ticketPrice.id == model.ticketPrice.id) {
                            ticket.quantity += model.quantity;
                            found = true;
                        }
                    });
                    if (!found) {
                        self.model.bookingRequest.tickets.push({ticketPrice:model.ticketPrice, quantity:model.quantity});
                    }
                }
            });
            this.ticketCategoriesView.model = null;
            $('option:selected', 'select').removeAttr('selected');
            this.ticketCategoriesView.render();
            this.updateQuantities();
        },
        updateQuantities:function () {
            // make sure that tickets are sorted by section and ticket category
            this.model.bookingRequest.tickets.sort(function (t1, t2) {
                if (t1.ticketPrice.section.id != t2.ticketPrice.section.id) {
                    return t1.ticketPrice.section.id - t2.ticketPrice.section.id;
                }
                else {
                    return t1.ticketPrice.ticketCategory.id - t2.ticketPrice.ticketCategory.id;
                }
            });

            this.model.bookingRequest.totals = _.reduce(this.model.bookingRequest.tickets, function (totals, ticketRequest) {
                return {
                    tickets:totals.tickets + ticketRequest.quantity,
                    price:totals.price + ticketRequest.quantity * ticketRequest.ticketPrice.price
                };
            }, {tickets:0, price:0.0});

            this.ticketSummaryView.render();
            this.setCheckoutStatus();
        },
        updateEmail:function (event) {
            if ($(event.currentTarget).is(':valid')) {
                this.model.bookingRequest.email = event.currentTarget.value;
                $("#error-email").empty();
            } else {
                $("#error-email").empty().append("Please enter a valid e-mail address");
                delete this.model.bookingRequest.email;
            }
            this.setCheckoutStatus();
        },
        setCheckoutStatus:function () {
            if (this.model.bookingRequest.totals != undefined &amp;&amp; this.model.bookingRequest.totals.tickets &gt; 0 &amp;&amp; this.model.bookingRequest.email != undefined &amp;&amp; this.model.bookingRequest.email != '') {
                $('input[name="submit"]').removeAttr('disabled');
            }
            else {
                $('input[name="submit"]').attr('disabled', true);
            }
        },
        watchForm: function() {
            if($("#email").length) {
                var self = this;
                var element = $("#email");
                if(element.val() !== self.formValues["email"]) {
                    self.formValues["email"] = element.val();
                    $("#email").change();
                }
                this.timerObject = setTimeout(function() {
                    self.watchForm();
                }, this.intervalDuration);
            } else {
                this.onClose();
            }
        },
        onClose: function() {
            if(this.timerObject) {
                clearTimeout(this.timerObject);
                delete this.timerObject;
            }
            this.ticketCategoriesView.close();
        }
    });

    return CreateBookingView;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above may be surprising! After all, we said that we were going to add a single view, but instead, we added three! This view makes use of two subviews (<code>TicketCategoriesView</code> and <code>TicketSummaryView</code>) for re-rendering parts of the main view. Whenever the user changes the current section, the list of available tickets is updated. Whenever the user adds the tickets to the booking, the booking summary is re-rendered. Changes in quantities or the target email may enable or disable the submission button - the booking is validated whenever changes to it are made. We do not create separate modules for the subviews, since they are not referenced outside the module itself.</p>
</div>
<div class="paragraph">
<p>The booking submission is handled by the <code>save</code> method which constructs a JSON object, as required by a POST to <code><a href="http://localhost:8080/ticket-monster/rest/bookings" class="bare">http://localhost:8080/ticket-monster/rest/bookings</a></code>, and performs the AJAX call. In case of a successful response, a confirmation view is rendered. On failure, a warning is displayed and the user may continue to edit the form.</p>
</div>
<div class="paragraph">
<p>The corresponding templates for the views above are shown below:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/desktop/booking-confirmation.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;div class="row"&gt;
    &lt;h2 class="special-title light-font"&gt;Booking #&lt;%=booking.id%&gt; confirmed!&lt;/h2&gt;
&lt;/div&gt;
&lt;div class="row"&gt;
    &lt;div class="col-md-6"&gt;
        &lt;div class="well"&gt;
            &lt;h4 class="page-header"&gt;Checkout information&lt;/h4&gt;
            &lt;p&gt;&lt;strong&gt;Email: &lt;/strong&gt;&lt;%= booking.contactEmail %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;Event: &lt;/strong&gt; &lt;%= performance.event.name %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;Venue: &lt;/strong&gt;&lt;%= performance.venue.name %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;Date: &lt;/strong&gt;&lt;%= new Date(booking.performance.date).toPrettyString() %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;Created on: &lt;/strong&gt;&lt;%= new Date(booking.createdOn).toPrettyString() %&gt;&lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="col-md-6"&gt;
        &lt;div class="well"&gt;
            &lt;h4 class="page-header"&gt;Ticket allocations&lt;/h4&gt;
            &lt;table class="table table-striped table-bordered" style="background-color: #fffffa;"&gt;
                &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th&gt;Ticket #&lt;/th&gt;
                    &lt;th&gt;Category&lt;/th&gt;
                    &lt;th&gt;Section&lt;/th&gt;
                    &lt;th&gt;Row&lt;/th&gt;
                    &lt;th&gt;Seat&lt;/th&gt;
                &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;
            &lt;% $.each(_.sortBy(booking.tickets, function(ticket) {return ticket.id}), function (i, ticket) { %&gt;
                &lt;tr&gt;
                    &lt;td&gt;&lt;%= ticket.id %&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;%=ticket.ticketCategory.description%&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;%=ticket.seat.section.name%&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;%=ticket.seat.rowNumber%&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;%=ticket.seat.number%&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;% }) %&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class="row" style="padding-bottom:30px;"&gt;
    &lt;div class="col-md-2"&gt;&lt;a href="#" class="highlight-link"&gt;Home&lt;/a&gt;&lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/desktop/create-booking.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;div class="row"&gt;
    &lt;div class="col-md-12"&gt;
        &lt;h2 class="special-title light-font"&gt;&lt;%=show.event.name%&gt;
            &lt;small&gt;&lt;%=show.venue.name%&gt;, &lt;%=new Date(performance.date).toPrettyString()%&gt;&lt;/p&gt;&lt;/small&gt;
        &lt;/h2&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class="row"&gt;
    &lt;div class="col-md-4"&gt;
        &lt;div class="well"&gt;
            &lt;h3 class="page-header"&gt;Select tickets&lt;/h3&gt;
            &lt;form class="form-horizontal"&gt;
                &lt;div id="sectionSelectorPlaceholder"&gt;
                    &lt;div class="form-group"&gt;
                        &lt;label class="col-md-3 control-label" for="sectionSelect"&gt;&lt;strong&gt;Section&lt;/strong&gt;&lt;/label&gt;
                        &lt;div class="col-md-9"&gt;
                            &lt;select id="sectionSelect" class="form-control"&gt;
                                &lt;option value="-1" selected="true"&gt;Choose a section&lt;/option&gt;
                                &lt;% _.each(sections, function(section) { %&gt;
                                &lt;option value="&lt;%=section.id%&gt;"&gt;&lt;%=section.name%&gt; - &lt;%=section.description%&gt;&lt;/option&gt;
                                &lt;% }) %&gt;
                            &lt;/select&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/form&gt;
            &lt;div id="ticketCategoriesViewPlaceholder"&gt;&lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div id="request-summary" class="col-md-5 col-md-offset-1"&gt;
        &lt;div class="well"&gt;
            &lt;h3 class="page-header"&gt;Order summary&lt;/h3&gt;
            &lt;div id="ticketSummaryView" class="row"/&gt;
            &lt;h3 class="page-header"&gt;Checkout&lt;/h3&gt;
            &lt;div class="row"&gt;
                &lt;div class="col-md-12"&gt;
                    &lt;form&gt;
                        &lt;div class="form-group"&gt;
                            &lt;input type='email' id="email" class="form-control" placeholder="Email" required/&gt;
                            &lt;p class="help-block error-notification"  id="error-email"&gt;&lt;/p&gt;
                        &lt;/div&gt;
                        &lt;div class="form-group"&gt;
                            &lt;input type='button' class="btn btn-primary" name="submit" value="Checkout"
                                   disabled="true"/&gt;
                        &lt;/div&gt;
                    &lt;/form&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/desktop/ticket-categories.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;% if (ticketPrices.length &gt; 0) { %&gt;
&lt;form class="form-horizontal"&gt;
    &lt;% _.each(ticketPrices, function(ticketPrice) { %&gt;
    &lt;div class="form-group" id="ticket-category-fieldset-&lt;%=ticketPrice.id%&gt;"&gt;
        &lt;label class="col-md-3 control-label"&gt;&lt;strong&gt;&lt;%=ticketPrice.ticketCategory.description%&gt;&lt;/strong&gt;&lt;/label&gt;

        &lt;div class="col-md-9"&gt;
            &lt;div class="input-group"&gt;
                &lt;input class="form-control col-md-6" rel="tooltip" title="Enter value"
                       data-tm-id="&lt;%=ticketPrice.id%&gt;"
                       placeholder="Number of tickets"
                       name="tickets-&lt;%=ticketPrice.ticketCategory.id%&gt;"/&gt;
                &lt;span class="input-group-addon"&gt;@ $&lt;%=ticketPrice.price%&gt;&lt;/span&gt;

                &lt;p class="help-block" id="error-input-&lt;%=ticketPrice.id%&gt;"&gt;&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;% }) %&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;div class="form-group"&gt;
    &lt;div class="col-md-offset-2"&gt;
        &lt;input type="button" class="btn btn-primary" disabled="true" name="add" value="Add tickets"/&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/form&gt;
&lt;% } %&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/desktop/ticket-summary-view.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;div class="col-md-12"&gt;
    &lt;% if (tickets.length&gt;0) { %&gt;
    &lt;table class="table table-bordered table-condensed" style="background-color: #fffffa;"&gt;
        &lt;thead&gt;
        &lt;tr&gt;
            &lt;th colspan="7"&gt;&lt;strong&gt;Requested tickets&lt;/strong&gt;&lt;/th&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;th&gt;Section&lt;/th&gt;
            &lt;th&gt;Category&lt;/th&gt;
            &lt;th&gt;Quantity&lt;/th&gt;
            &lt;th&gt;Price&lt;/th&gt;
            &lt;th&gt;&lt;/th&gt;
        &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody id="ticketRequestSummary"&gt;
        &lt;% _.each(tickets, function (ticketRequest, index, tickets) { %&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;%= ticketRequest.ticketPrice.section.name %&gt;&lt;/td&gt;
            &lt;td&gt;&lt;%= ticketRequest.ticketPrice.ticketCategory.description %&gt;&lt;/td&gt;
            &lt;td&gt;&lt;%= ticketRequest.quantity %&gt;&lt;/td&gt;
            &lt;td&gt;$&lt;%=ticketRequest.ticketPrice.price%&gt;&lt;/td&gt;
            &lt;td&gt;&lt;span class="glyphicon glyphicon-trash" data-index='&lt;%= index %&gt;'/&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;% }); %&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;
    &lt;p/&gt;
    &lt;div class="row"&gt;
        &lt;div class="col-md-5"&gt;&lt;strong&gt;Total ticket count:&lt;/strong&gt; &lt;%= totals.tickets %&gt;&lt;/div&gt;
        &lt;div class="col-md-5"&gt;&lt;strong&gt;Total price:&lt;/strong&gt; $&lt;%=totals.price%&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;% } else { %&gt;
    No tickets requested.
    &lt;% } %&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, once the view is available, we can add it&#8217;s corresponding routing rule:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/router/desktop/router.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * A module for the router of the desktop application
 */
define("router", [
    ...
    'app/views/desktop/create-booking',
	...
],function (
			...
            CreateBookingView,
            ...
            ) {

    var Router = Backbone.Router.extend({
        ...
        routes:{
            ...
            "book/:showId/:performanceId":"bookTickets",
        },
        ...
        bookTickets:function (showId, performanceId) {
            var createBookingView =
                new CreateBookingView({
                    model:{ showId:showId,
                            performanceId:performanceId,
                            bookingRequest:{tickets:[]}},
                            el:$("#content")
                           });
            utilities.viewManager.showView(createBookingView);
        }
    }
    ...
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This concludes the implementation of the booking use case. We started by listing the available events, continued by selecting a venue and performance time, and ended by choosing tickets and completing the order.</p>
</div>
<div class="paragraph">
<p>The other use cases: a booking starting from venues and view existing bookings are conceptually similar, so you can just copy the logic for the following routes from <code>src/main/webapp/resources/js/app/routers/desktop/router.js</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>venues</code></p>
</li>
<li>
<p><code>venues/:id</code></p>
</li>
<li>
<p><code>bookings</code></p>
</li>
<li>
<p><code>bookings/:id</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, copy the following files in the <code>src/main/webapp/resources/js/app/models</code>, <code>src/main/webapp/resources/js/app/collections</code>,
<code>src/main/webapp/resources/js/app/views/desktop</code> and <code>src/main/webapp/resources/templates</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>src/main/webapp/resources/js/app/models/booking.js</code></p>
</li>
<li>
<p><code>src/main/webapp/resources/js/app/models/venue.js</code></p>
</li>
<li>
<p><code>src/main/webapp/resources/js/app/collections/bookings.js</code></p>
</li>
<li>
<p><code>src/main/webapp/resources/js/app/collections/venues.js</code></p>
</li>
<li>
<p><code>src/main/webapp/resources/js/app/views/desktop/bookings.js</code></p>
</li>
<li>
<p><code>src/main/webapp/resources/js/app/views/desktop/booking-detail.js</code></p>
</li>
<li>
<p><code>src/main/webapp/resources/js/app/views/desktop/venues.js</code></p>
</li>
<li>
<p><code>src/main/webapp/resources/js/app/views/desktop/venue-detail.js</code></p>
</li>
<li>
<p><code>src/main/webapp/resources/templates/desktop/booking-details.html</code></p>
</li>
<li>
<p><code>src/main/webapp/resources/templates/desktop/booking-table.html</code></p>
</li>
<li>
<p><code>src/main/webapp/resources/templates/desktop/venues.html</code></p>
</li>
<li>
<p><code>src/main/webapp/resources/templates/desktop/venue-detail.html</code></p>
</li>
<li>
<p><code>src/main/webapp/resources/templates/desktop/venue-event-description.html</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mobile_view">Mobile view</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The mobile version of the application uses approximately the same architecture as the desktop version. Any differences are due to the functional changes in the mobile version and the use of jQuery mobile.</p>
</div>
<div class="sect2">
<h3 id="_setting_up_the_structure_2">Setting up the structure</h3>
<div class="paragraph">
<p>The first step in implementing our solution is to copy the CSS and JavaScript libraries to <code>resources/css</code> and <code>resources/js/libs</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">require.js</dt>
<dd>
<p>AMD support, along with the plugin:</p>
<div class="ulist">
<ul>
<li>
<p>text - for loading text files, in our case the HTML templates</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">jQuery</dt>
<dd>
<p>general purpose library for HTML traversal and manipulation</p>
</dd>
<dt class="hdlist1">Underscore</dt>
<dd>
<p>JavaScript utility library (and a dependency of Backbone)</p>
</dd>
<dt class="hdlist1">Backbone</dt>
<dd>
<p>Client-side MVC framework</p>
</dd>
<dt class="hdlist1">jQuery Mobile</dt>
<dd>
<p>user interface system for mobile devices;</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>(If you have already built the desktop application, some files may already be in place.)</p>
</div>
<div class="paragraph">
<p>For mobile clients, the main page will display the mobile version of the application, by loading the mobile AMD module of the application. Let us create it.</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/configurations/mobile.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * Shortcut alias definitions - will come in handy when declaring dependencies
 * Also, they allow you to keep the code free of any knowledge about library
 * locations and versions
 */
require.config({
    baseUrl:"resources/js",
    paths: {
        jquery:'libs/jquery-2.0.3',
        jquerymobile:'libs/jquery.mobile-1.4.2',
        text:'libs/text',
        underscore:'libs/underscore',
        backbone: 'libs/backbone',
        utilities: 'app/utilities',
        router:'app/router/mobile/router'
    },
    // We shim Backbone.js and Underscore.js since they don't declare AMD modules
    shim: {
        'backbone': {
            deps: ['underscore', 'jquery'],
            exports: 'Backbone'
        },

        'underscore': {
            exports: '_'
        }
    }
});

define("configuration", function() {
    if (window.TicketMonster != undefined &amp;&amp; TicketMonster.config != undefined) {
        return {
            baseUrl: TicketMonster.config.baseRESTUrl
        };
    } else {
        return {
            baseUrl: ""
        };
    }
});

define("initializer", [
    'jquery',
    'utilities',
    'text!../templates/mobile/main.html'
], function ($,
             utilities,
             MainTemplate) {
    // Configure jQuery to append timestamps to requests, to bypass browser caches
    // Important for MSIE
    $.ajaxSetup({cache:false});
    $('head').append('&lt;link rel="stylesheet" href="resources/css/jquery.mobile-1.4.2.css"/&gt;');
    $('head').append('&lt;link rel="stylesheet" href="resources/css/m.screen.css"/&gt;');
    // Bind to mobileinit before loading jQueryMobile
    $(document).bind("mobileinit", function () {
        // Prior to creating and starting the router, we disable jQuery Mobile's own routing mechanism
        $.mobile.hashListeningEnabled = false;
        $.mobile.linkBindingEnabled = false;
        $.mobile.pushStateEnabled = false;

        // Fix jQueryMobile header and footer positioning issues for iOS.
        // See: https://github.com/jquery/jquery-mobile/issues/4113 and
        // https://github.com/jquery/jquery-mobile/issues/5532
        $(document).on('blur', 'input, textarea, select', function() {
            setTimeout(function() {
            window.scrollTo(document.body.scrollLeft, document.body.scrollTop);
            }, 0);
        });

        utilities.applyTemplate($('body'), MainTemplate);
    });
    // Then (load jQueryMobile and) start the router to finally start the app
    require(['router']);
});

// Now we declare all the dependencies
// This loads and runs the 'initializer' module.
require(['initializer']);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this application, we combine Backbone and jQuery Mobile. Each framework has its own strengths; jQuery Mobile provides UI components and touch support, whilst Backbone provides MVC support. There is some overlap between the two, as jQuery Mobile provides its own navigation mechanism which we disable.</p>
</div>
<div class="paragraph">
<p>We also define a <code>configuration</code> module which allows the customization of the base URLs for RESTful invocations. This module does not play any role in the mobile web version. We will come to it, however, when discussing hybrid applications.</p>
</div>
<div class="paragraph">
<p>We also define a special initializer module (<code>initializer</code>) that, when loaded, adds the stylesheets and applies the template for the general structure of the page in the <code>body</code> element. In the initializer module we make customizations in order to get the two frameworks working together - disabling the jQuery Mobile navigation. Let us add the template definition for the template loaded by the initializer module.</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/mobile/main.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;!--
    The main layout of the page - contains the menu and the 'content' &amp;lt;div/&amp;gt; in which all the
    views will render the content.
--&gt;
&lt;div id="container" data-role="page" data-ajax="false"&gt;&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy over the <code>m.screen.css</code> file referenced in the <code>initializer</code> module, from the project sources, to the appropriate location in the workspace.</p>
</div>
<div class="paragraph">
<p>Next, we create the application router.</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/router/mobile/router.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * A module for the router of the mobile application.
 *
 */
define("router",[
    'jquery',
    'jquerymobile',
    'underscore',
    'utilities'
],function ($,
            jqm,
            _,
            utilities) {

    /**
     * The Router class contains all the routes within the application - i.e. URLs and the actions
     * that will be taken as a result.
     *
     * @type {Router}
     */
    var Router = Backbone.Router.extend({
        initialize: function() {
            //Begin dispatching routes
            Backbone.history.start();
        },
        execute : function(callback, args) {
            $.mobile.loading("show");
            window.setTimeout(function() {
                if (callback) {
                    callback.apply(this, args);
                }
                $.mobile.loading("hide");
            }, 300);
        }
    });

    // Create a router instance
    var router = new Router();

    return router;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the router code we add the <code>execute</code> method to the router for handling transitions between routes. Here, we will display the jQuery Mobile loader widget before displaying any Backbone view, and then hide it once the view is rendered.</p>
</div>
<div class="paragraph">
<p>Next, we need to create a first page.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_landing_page">The landing page</h3>
<div class="paragraph">
<p>The first page in our application is the landing page. First, we add the template for it:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/mobile/home-view.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;div data-role="header"&gt;
    &lt;h3&gt;Ticket Monster&lt;/h3&gt;
&lt;/div&gt;
&lt;div class="ui-content"&gt;
    &lt;img src="resources/img/rhjb_eap_logo.png" /&gt;
    &lt;h4&gt;Find events&lt;/h4&gt;
    &lt;ul data-role="listview"&gt;
        &lt;li&gt;
            &lt;a href="#events"&gt;By Category&lt;/a&gt;
        &lt;/li&gt;
        &lt;li&gt;
            &lt;a href="#venues"&gt;By Location&lt;/a&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have to add the page to the router:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/router/mobile/router.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * A module for the router of the mobile application.
 *
 */
define("router",[
    ...
    'text!../templates/mobile/home-view.html'
],function (
		...
        HomeViewTemplate) {

	...
    var Router = Backbone.Router.extend({
        ...
        routes:{
            "":"home"
        },
        ...
        home:function () {
            utilities.applyTemplate($("#container"), HomeViewTemplate);
            $("#container").enhanceWithin();
    	}
    });
    ...
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because jQuery Mobile navigation is disabled, we must tell jQuery Mobile explicitly to enhance the page content in order to create the mobile view. Here, we enhance the page using the <code>enhanceWithin</code> method, to ensure that the page gets the appropriate look and feel.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_events_view">The events view</h3>
<div class="paragraph">
<p>First, we display a list of events (just as in the desktop view). Since mobile interfaces are more constrained, we will just show a simple list view:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/views/mobile/events.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">define([
    'utilities',
    'text!../../../../templates/mobile/events.html'
], function (
    utilities,
    eventsView) {

    var EventsView = Backbone.View.extend({
        render:function () {
            var categories = _.uniq(
                _.map(this.model.models, function(model){
                    return model.get('category');
                }), false, function(item){
                    return item.id;
                });
            utilities.applyTemplate($(this.el), eventsView,  {categories:categories, model:this.model});
            $(this.el).enhanceWithin();
            return this;
        }
    });

    return EventsView;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the view is very similar to the desktop view, the main difference being the explicit hint to jQuery mobile through the <code>pagecreate</code> event invocation.</p>
</div>
<div class="paragraph">
<p>Next, we add the template for rendering the view:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/mobile/events.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;div data-role="header"&gt;
    &lt;a href="#" class="ui-btn ui-icon-home ui-btn-icon-left"&gt;Home&lt;/a&gt;
    &lt;h3&gt;Categories&lt;/h3&gt;
&lt;/div&gt;
&lt;div class="ui-content"&gt;
    &lt;div id="itemMenu" data-role="collapsible-set" data-inset="false"&gt;
        &lt;%
        _.each(categories, function (category) {
        %&gt;
        &lt;div data-role="collapsible"&gt;
            &lt;h2&gt;&lt;%= category.description %&gt;&lt;/h2&gt;
            &lt;ul id="categoryMenu" data-role="listview" data-inset="true"&gt;
            &lt;%
            _.each(model.models, function (model) {
                if (model.get('category').id == category.id) {
                %&gt;
                &lt;li&gt;
                    &lt;a href="#events/&lt;%=model.attributes.id%&gt;"&gt;&lt;%=model.attributes.name%&gt;&lt;/a&gt;
                &lt;/li&gt;
                &lt;% }
            });
            %&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
        &lt;% }); %&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally, we need to instruct the router to invoke the page:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/router/mobile/router.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * A module for the router of the desktop application.
 *
 */
define("router",[
    ...
	'app/collections/events',
	...
	'app/views/mobile/events'
	...
],function (
	...,
	Events,
	...,
	EventsView,
	...) {

	...
    var Router = Backbone.Router.extend({
        ...
        routes:{
        	...
            "events":"events"
            ...
        },
        ...
        events:function () {
            var events = new Events;
            var eventsView = new EventsView({model:events, el:$("#container")});
            events.on("reset", function() {
                utilities.viewManager.showView(eventsView);
            }).fetch({
                reset : true,
                error : function() {
                    utilities.displayAlert("Failed to retrieve events from the TicketMonster server.");
                }
            });
        }
        ...
    });
    ...
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as in the case of the desktop application, the list of events will be accessible at <code>#events</code> (i.e. <code><a href="http://localhost:8080/ticket-monster/#events" class="bare">http://localhost:8080/ticket-monster/#events</a></code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_displaying_an_individual_event">Displaying an individual event</h3>
<div class="paragraph">
<p>Now, we create the view to display an event:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/views/mobile/event-detail.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">define([
    'utilities',
    'require',
    'configuration',
    'text!../../../../templates/mobile/event-detail.html',
    'text!../../../../templates/mobile/event-venue-description.html'
], function (
    utilities,
    require,
    config,
    eventDetail,
    eventVenueDescription) {

    var EventDetailView = Backbone.View.extend({
        events:{
            "click a[id='bookButton']":"beginBooking",
            "change select[id='showSelector']":"refreshShows",
            "change select[id='performanceTimes']":"performanceSelected",
            "change select[id='dayPicker']":'refreshTimes'
        },
        render:function () {
            $(this.el).empty()
            utilities.applyTemplate($(this.el), eventDetail, _.extend({}, this.model.attributes, config));
            $(this.el).enhanceWithin();
            $("#bookButton").addClass("ui-disabled");
            var self = this;
            $.getJSON(config.baseUrl + "rest/shows?event=" + this.model.get('id'), function (shows) {
                self.shows = shows;
                $("#showSelector").empty().append("&lt;option data-placeholder='true'&gt;Choose a venue ...&lt;/option&gt;");
                $.each(shows, function (i, show) {
                    $("#showSelector").append("&lt;option value='" + show.id + "'&gt;" + show.venue.address.city + " : " + show.venue.name + "&lt;/option&gt;");
                });
                $("#showSelector").selectmenu('refresh', true)
                $("#dayPicker").selectmenu('disable')
                $("#dayPicker").empty().append("&lt;option data-placeholder='true'&gt;Choose a show date ...&lt;/option&gt;")
                $("#performanceTimes").selectmenu('disable')
                $("#performanceTimes").empty().append("&lt;option data-placeholder='true'&gt;Choose a show time ...&lt;/option&gt;")
            });
            $("#dayPicker").empty();
            $("#dayPicker").selectmenu('disable');
            $("#performanceTimes").empty();
            $("#performanceTimes").selectmenu('disable');
            $(this.el).enhanceWithin();
            return this;
        },
        performanceSelected:function () {
            if ($("#performanceTimes").val() != 'Choose a show time ...') {
                $("#bookButton").removeClass("ui-disabled")
            } else {
                $("#bookButton").addClass("ui-disabled")
            }
        },
        beginBooking:function () {
            require('router').navigate('book/' + $("#showSelector option:selected").val() + '/' + $("#performanceTimes").val(), true)
        },
        refreshShows:function (event) {

            var selectedShowId = event.currentTarget.value;

            if (selectedShowId != 'Choose a venue ...') {
                var selectedShow = _.find(this.shows, function (show) {
                    return show.id == selectedShowId
                });
                this.selectedShow = selectedShow;
                var times = _.uniq(_.sortBy(_.map(selectedShow.performances, function (performance) {
                    return (new Date(performance.date).withoutTimeOfDay()).getTime()
                }), function (item) {
                    return item
                }));
                utilities.applyTemplate($("#eventVenueDescription"), eventVenueDescription, _.extend({},{venue:selectedShow.venue},config));
                $("#detailsCollapsible").show()
                $("#dayPicker").removeAttr('disabled')
                $("#performanceTimes").removeAttr('disabled')
                $("#dayPicker").empty().append("&lt;option data-placeholder='true'&gt;Choose a show date ...&lt;/option&gt;")
                _.each(times, function (time) {
                    var date = new Date(time)
                    $("#dayPicker").append("&lt;option value='" + date.toYMD() + "'&gt;" + date.toPrettyStringWithoutTime() + "&lt;/option&gt;")
                });
                $("#dayPicker").selectmenu('refresh')
                $("#dayPicker").selectmenu('enable')
                this.refreshTimes()
            } else {
                $("#detailsCollapsible").hide()
                $("#eventVenueDescription").empty()
                $("#dayPicker").empty()
                $("#dayPicker").selectmenu('disable')
                $("#performanceTimes").empty()
                $("#performanceTimes").selectmenu('disable')
            }


        },
        refreshTimes:function () {
            var selectedDate = $("#dayPicker").val();
            $("#performanceTimes").empty().append("&lt;option data-placeholder='true'&gt;Choose a show time ...&lt;/option&gt;")
            if (selectedDate) {
                $.each(this.selectedShow.performances, function (i, performance) {
                    var performanceDate = new Date(performance.date);
                    if (_.isEqual(performanceDate.toYMD(), selectedDate)) {
                        $("#performanceTimes").append("&lt;option value='" + performance.id + "'&gt;" + performanceDate.getHours().toZeroPaddedString(2) + ":" + performanceDate.getMinutes().toZeroPaddedString(2) + "&lt;/option&gt;")
                    }
                })
                $("#performanceTimes").selectmenu('enable')
            }
            $("#performanceTimes").selectmenu('refresh')
            this.performanceSelected()
        }

    });

    return EventDetailView;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again, this is very similar to the desktop version. Now we add the page templates:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/mobile/event-detail.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;div data-role="header" data-position="fixed"&gt;
    &lt;a href="#" class="ui-btn ui-icon-home ui-btn-icon-left"&gt;Home&lt;/a&gt;
    &lt;h3&gt;Book tickets&lt;/h3&gt;
&lt;/div&gt;
&lt;div class="ui-content"&gt;
    &lt;h3&gt;&lt;%=name%&gt;&lt;/h3&gt;
    &lt;img width='100px' src='&lt;%=baseUrl%&gt;rest/media/&lt;%=mediaItem.id%&gt;'/&gt;
    &lt;p&gt;&lt;%=description%&gt;&lt;/p&gt;
    &lt;div class="ui-field-contain"&gt;
        &lt;label for="showSelector"&gt;&lt;strong&gt;Where&lt;/strong&gt;&lt;/label&gt;
        &lt;select id='showSelector' data-mini='true'/&gt;
    &lt;/div&gt;

    &lt;div data-role="collapsible" data-content-theme="c" style="display: none;"
         id="detailsCollapsible"&gt;
        &lt;h3&gt;Venue details&lt;/h3&gt;

        &lt;div id="eventVenueDescription"&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;div data-role='fieldcontain'&gt;
        &lt;fieldset data-role='controlgroup'&gt;
            &lt;legend&gt;&lt;strong&gt;When&lt;/strong&gt;&lt;/legend&gt;
            &lt;label for="dayPicker"&gt;When:&lt;/label&gt;
            &lt;select id='dayPicker' data-mini='true'/&gt;

            &lt;label for="performanceTimes"&gt;When:&lt;/label&gt;
            &lt;select id="performanceTimes" data-mini='true'/&gt;

        &lt;/fieldset&gt;
    &lt;/div&gt;

&lt;/div&gt;
&lt;div data-role="footer" data-position="fixed"&gt;
    &lt;div class="ui-grid-b"&gt;
        &lt;div class="ui-block-a"&gt;&lt;/div&gt;
        &lt;div class="ui-block-b"&gt;&lt;/div&gt;
        &lt;div class="ui-block-c"&gt;
            &lt;a id='bookButton' class="ui-btn ui-btn-b ui-icon-check ui-btn-icon-left block-btn"&gt;Book&lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/mobile/event-venue-description.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;img width="100" src="&lt;%=baseUrl%&gt;rest/media/&lt;%=venue.mediaItem.id%&gt;"/&gt;&lt;/p&gt;
&lt;%= venue.description %&gt;
&lt;address&gt;
    &lt;p&gt;&lt;strong&gt;Address:&lt;/strong&gt;&lt;/p&gt;
    &lt;p&gt;&lt;%= venue.address.street %&gt;&lt;/p&gt;
    &lt;p&gt;&lt;%= venue.address.city %&gt;, &lt;%= venue.address.country %&gt;&lt;/p&gt;
&lt;/address&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we add this to the router, explicitly indicating to jQuery Mobile that a transition has to take place after the view is rendered - in order to allow the page to render correctly after it has been invoked from the listview.</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/router/mobile/router.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * A module for the router of the desktop application.
 *
 */
define("router",[
    ...
	'app/models/event',
	...
	'app/views/mobile/event-detail'
	...
],function (
	...,
	Event,
	...,
	EventDetailView,
	...) {

	...
    var Router = Backbone.Router.extend({
        ...
        routes:{
        	...
            "events/:id":"eventDetail",
            ...
        },
        ...
        eventDetail:function (id) {
            var model = new Event({id:id});
            var eventDetailView = new EventDetailView({model:model, el:$("#container")});
            model.on("change",
                function () {
                    utilities.viewManager.showView(eventDetailView);
                    $("body").pagecontainer("change", "#container", {transition:'slide', changeHash:false});
                }).fetch({
                    error : function() {
                        utilities.displayAlert("Failed to retrieve the event from the TicketMonster server.");
                    }
                });
        }
        ...
    });
    ...
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as the desktop version, the mobile event detail view allows users to choose a venue and a performance time. The next step is to allow the user to book some tickets.</p>
</div>
</div>
<div class="sect2">
<h3 id="_booking_tickets">Booking tickets</h3>
<div class="paragraph">
<p>The views to book tickets are simpler than the desktop version. Users can select a section and enter the number of tickets for each category however, there is no way to add or remove tickets from an order. Once the form is filled out, the user can only submit it.</p>
</div>
<div class="paragraph">
<p>First, we create the views:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/views/mobile/create-booking.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">define([
    'utilities',
    'configuration',
    'require',
    'text!../../../../templates/mobile/booking-details.html',
    'text!../../../../templates/mobile/create-booking.html',
    'text!../../../../templates/mobile/confirm-booking.html',
    'text!../../../../templates/mobile/ticket-entries.html',
    'text!../../../../templates/mobile/ticket-summary-view.html'
], function (
    utilities,
    config,
    require,
    bookingDetailsTemplate,
    createBookingTemplate,
    confirmBookingTemplate,
    ticketEntriesTemplate,
    ticketSummaryViewTemplate) {

    var TicketCategoriesView = Backbone.View.extend({
        id:'categoriesView',
        events:{
            "change input":"onChange"
        },
        render:function () {
            var views = {};

            if (this.model != null) {
                var ticketPrices = _.map(this.model, function (item) {
                    return item.ticketPrice;
                });
                utilities.applyTemplate($(this.el), ticketEntriesTemplate, {ticketPrices:ticketPrices});
            } else {
                $(this.el).empty();
            }
            return this;
        },
        onChange:function (event) {
            var value = event.currentTarget.value;
            var ticketPriceId = $(event.currentTarget).data("tm-id");
            var modifiedModelEntry = _.find(this.model, function(item) { return item.ticketPrice.id == ticketPriceId});
            if ($.isNumeric(value) &amp;&amp; value &gt; 0) {
                modifiedModelEntry.quantity = parseInt(value);
            }
            else {
                delete modifiedModelEntry.quantity;
            }
        }
    });

     var TicketSummaryView = Backbone.View.extend({
        render:function () {
            utilities.applyTemplate($(this.el), ticketSummaryViewTemplate, this.model.bookingRequest)
        }
    });

    var CreateBookingView = Backbone.View.extend({

        currentView: "CreateBooking",
        intervalDuration : 100,
        formValues : [],
        events:{
            "click a[id='confirmBooking']":"checkout",
            "change select":"refreshPrices",
            "change input[type='number']":"updateForm",
            "change input[name='email']":"updateForm",
            "click a[id='saveBooking']":"saveBooking",
            "click a[id='goBack']":"back",
            "click a[data-action='delete']":"deleteBooking"
        },
        render: function() {
            if (this.currentView === "CreateBooking") {
                this.renderCreateBooking();
            } else if(this.currentView === "ConfirmBooking") {
                this.renderConfirmBooking();
            }
            return this;
        },
        renderCreateBooking:function () {

            var self = this;

            $.getJSON(config.baseUrl + "rest/shows/" + this.model.showId, function (selectedShow) {
                self.model.performance = _.find(selectedShow.performances, function (item) {
                    return item.id == self.model.performanceId;
                });
                self.model.email = self.model.email || "";
                var id = function (item) {return item.id;};
                // prepare a list of sections to populate the dropdown
                var sections = _.uniq(_.sortBy(_.pluck(selectedShow.ticketPrices, 'section'), id), true, id);

                utilities.applyTemplate($(self.el), createBookingTemplate, { show:selectedShow,
                    performance:self.model.performance,
                    sections:sections,
                    email:self.model.email});
                $(self.el).enhanceWithin();
                self.ticketCategoriesView = new TicketCategoriesView({model:{}, el:$("#ticketCategoriesViewPlaceholder") });
                self.model.show = selectedShow;
                self.ticketCategoriesView.render();
                $('a[id="confirmBooking"]').addClass('ui-disabled');
                $("#sectionSelector").change();
                self.watchForm();
            });

        },
        refreshPrices:function (event) {
            if (event.currentTarget.value != "Choose a section") {
                var ticketPrices = _.filter(this.model.show.ticketPrices, function (item) {
                    return item.section.id == event.currentTarget.value;
                });
                var ticketPriceInputs = new Array();
                _.each(ticketPrices, function (ticketPrice) {
                    var model = {};
                    model.ticketPrice = ticketPrice;
                    ticketPriceInputs.push(model);
                });
                $("#ticketCategoriesViewPlaceholder").show();
                this.ticketCategoriesView.model = ticketPriceInputs;
                this.ticketCategoriesView.render();
                $(this.el).enhanceWithin();
            } else {
                $("#ticketCategoriesViewPlaceholder").hide();
                this.ticketCategoriesView.model = new Array();
                this.updateForm();
            }
        },
        checkout:function () {
            var savedTicketRequests = this.model.bookingRequest.tickets = this.model.bookingRequest.tickets || [];
            _.each(this.ticketCategoriesView.model, function(newTicketRequest){
                var matchingRequest = _.find(savedTicketRequests, function(ticketRequest) {
                    return ticketRequest.ticketPrice.id == newTicketRequest.ticketPrice.id;
                });
                if(newTicketRequest.quantity) {
                    if(matchingRequest) {
                        matchingRequest.quantity += newTicketRequest.quantity;
                    } else {
                        savedTicketRequests.push(newTicketRequest);
                    }
                }
            });
            this.model.bookingRequest.totals = this.computeTotals(this.model.bookingRequest.tickets);
            this.currentView = "ConfirmBooking";
            this.render();
        },
        updateForm:function () {
            var valid = true;
            this.model.email = $("input[type='email']").val();
            $("input[type='number']").each(function(idx,element) {
                var quantity = $(this).val();
                if(quantity.length &gt; 0 &amp;&amp;
                    (!$.isNumeric(quantity)  // is a non-number, other than empty string
                        || quantity &lt;= 0 // is negative
                        || parseFloat(quantity) != parseInt(quantity))) {
                    $("#error-" + element.id).empty().append("Should be a positive number.");
                    valid = false;
                } else {
                    $("#error-" + element.id).empty();
                }
            });
            try {
                var validElements = document.querySelectorAll(":valid");
                var $email = $("#email");
                var emailElem = $email.get(0);
                var validEmail = false;
                for (var ctr=0; ctr &lt; validElements.length; ctr++) {
                    if (emailElem === validElements[ctr]) {
                        validEmail = true;
                    }
                }
                if(validEmail) {
                    this.model.email = $email.val();
                    $("#error-email").empty();
                } else {
                    $("#error-email").empty().append("Please enter a valid e-mail address");
                    delete this.model.email;
                    valid = false;
                }
            }
            catch(e) {
                // For browsers like IE9 that do fail on querySelectorAll for CSS pseudo selectors,
                // we use the regex defined in the HTML5 spec.
                var emailRegex = new RegExp("[a-zA-Z0-9.!#$%&amp;'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*");
                var emailValue = $("#email").val();
                if(emailRegex.test(emailValue)) {
                    this.model.email = emailValue;
                    $("#error-email").empty();
                } else {
                    $("#error-email").empty().append("Please enter a valid e-mail address");
                    delete this.model.email;
                    valid = false;
                }
            }
            var totals = this.computeTotals(this.ticketCategoriesView.model);
            if (totals.tickets &gt; 0 &amp;&amp; valid) {
                $('a[id="confirmBooking"]').removeClass('ui-disabled');
            } else {
                $('a[id="confirmBooking"]').addClass('ui-disabled');
            }
        },
        computeTotals: function(ticketRequestCollection) {
            var totals = _.reduce(ticketRequestCollection, function (partial, model) {
                if (model.quantity != undefined) {
                    partial.tickets += model.quantity;
                    partial.price += model.quantity * model.ticketPrice.price;
                    return partial;
                } else {
                    return partial;
                }
            }, {tickets:0, price:0.0});
            return totals;
        },
        renderConfirmBooking:function () {
            utilities.applyTemplate($(this.el), confirmBookingTemplate, this.model);
            this.ticketSummaryView = new TicketSummaryView({model:this.model, el:$("#ticketSummaryView")});
            this.ticketSummaryView.render();
            $(this.el).enhanceWithin();
            if (this.model.bookingRequest.totals.tickets &gt; 0) {
                $('a[id="saveBooking"]').removeClass('ui-disabled');
            } else {
                $('a[id="saveBooking"]').addClass('ui-disabled');
            }
            return this;
        },
        back:function () {
            this.currentView = "CreateBooking";
            this.render();
        },
        saveBooking:function (event) {
            var bookingRequest = {ticketRequests:[]};
            var self = this;
            _.each(this.model.bookingRequest.tickets, function (model) {
                if (model.quantity != undefined) {
                    bookingRequest.ticketRequests.push({ticketPrice:model.ticketPrice.id, quantity:model.quantity})
                }
            });

            bookingRequest.email = this.model.email;
            bookingRequest.performance = this.model.performanceId;
            $.ajax({url:(config.baseUrl + "rest/bookings"),
                data:JSON.stringify(bookingRequest),
                type:"POST",
                dataType:"json",
                contentType:"application/json",
                success:function (booking) {
                    utilities.applyTemplate($(self.el), bookingDetailsTemplate, booking);
                    $(self.el).enhanceWithin();
                }}).error(function (error) {
                    try {
                        var response = JSON.parse(error.responseText);
                        var displayMessage = "";
                        if(response &amp;&amp; response.errors) {
                            var errors = response.errors;
                            for(var idx = 0; idx &lt; errors.length; idx++) {
                                displayMessage += errors[idx] + "\n";
                            }
                            alert(displayMessage);
                        } else {
                            alert("Failed to perform the bookng.");
                        }
                    } catch (e) {
                        alert("Failed to perform the bookng.");
                    }
                });
        },
        deleteBooking: function(event) {
            var deletedIdx = $(event.currentTarget).data("ticketpriceid");
            this.model.bookingRequest.tickets = _.reject(this.model.bookingRequest.tickets, function(ticketRequest) {
                return ticketRequest.ticketPrice.id == deletedIdx;
            });
            this.model.bookingRequest.totals = this.computeTotals(this.model.bookingRequest.tickets);
            this.renderConfirmBooking();
            return false;
        },
        watchForm: function() {
            if($("#sectionSelect").length) {
                var self = this;
                $("input").each( function(index,element) {
                    if(element.value !== self.formValues[element.id]) {
                        self.formValues[element.id] = element.value;
                        $("input[id='"+element.id+"']").change();
                    }
                });
                this.timerObject = setTimeout(function() {
                    self.watchForm();
                }, this.intervalDuration);
            } else {
                this.onClose();
            }
        },
        onClose: function() {
            if(this.timerObject) {
                clearTimeout(this.timerObject);
                delete this.timerObject;
            }
        }
    });
    return CreateBookingView;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The views follow the structure the desktop application, except that the summary view is not rendered inline but after a page
transition.</p>
</div>
<div class="paragraph">
<p>Next, we create the page fragment templates. First, the actual page:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/mobile/create-booking.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;div data-role="header" data-position="fixed"&gt;
    &lt;a href="#" class="ui-btn ui-icon-home ui-btn-icon-left"&gt;Home&lt;/a&gt;
    &lt;h1&gt;Book tickets&lt;/h1&gt;
&lt;/div&gt;
&lt;div class="ui-content"&gt;
    &lt;p&gt;
       &lt;h3&gt;&lt;%=show.event.name%&gt;&lt;/h3&gt;
    &lt;/p&gt;
    &lt;p&gt;
      &lt;%=show.venue.name%&gt;
    &lt;p&gt;

    &lt;p&gt;
      &lt;small&gt;&lt;%=new Date(performance.date).toPrettyString()%&gt;&lt;/small&gt;
    &lt;/p&gt;
    &lt;div id="sectionSelectorPlaceholder"&gt;
        &lt;div class="ui-field-contain"&gt;
            &lt;label for="sectionSelect"&gt;Section&lt;/label&gt;
            &lt;select id="sectionSelect"&gt;
                &lt;option value="-1" selected&gt;Choose a section&lt;/option&gt;
                &lt;% _.each(sections, function(section) { %&gt;
                &lt;option value="&lt;%=section.id%&gt;"&gt;&lt;%=section.name%&gt; - &lt;%=section.description%&gt;&lt;/option&gt;
                &lt;% }) %&gt;
            &lt;/select&gt;
        &lt;/div&gt;

    &lt;/div&gt;
    &lt;div id="ticketCategoriesViewPlaceholder" style="display:none;"&gt;&lt;/div&gt;

    &lt;div class="fieldcontain"&gt;
        &lt;label&gt;Contact email&lt;/label&gt;
        &lt;input type='email' id='email' name='email' required placeholder="Email" value="&lt;%=email%&gt;" /&gt;
        &lt;span id="error-email" class="error" /&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div data-role="footer" data-position="fixed"&gt;
    &lt;div class="ui-grid-a"&gt;
        &lt;div class="ui-block-a"&gt;&lt;a href="#" class="ui-btn ui-icon-delete ui-btn-icon-left block-btn"&gt;Cancel&lt;/a&gt;&lt;/div&gt;
        &lt;div class="ui-block-b"&gt;&lt;a id="confirmBooking" class="ui-btn ui-btn-b ui-icon-check ui-btn-icon-left block-btn" disabled&gt;Checkout&lt;/a&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, the fragment that contains the input form for tickets, which is re-rendered whenever the section is changed:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/mobile/ticket-entries.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;% if (ticketPrices.length &gt; 0) { %&gt;
    &lt;form name="ticketCategories" id="ticketCategories"&gt;
    &lt;h4&gt;Select tickets by category&lt;/h4&gt;
    &lt;% _.each(ticketPrices, function(ticketPrice) { %&gt;
      &lt;div id="ticket-category-input-&lt;%=ticketPrice.id%&gt;"/&gt;

      &lt;fieldset class="ui-field-contain"&gt;
         &lt;label for="ticket-&lt;%=ticketPrice.id%&gt;"&gt;&lt;%=ticketPrice.ticketCategory.description%&gt;($&lt;%=ticketPrice.price%&gt;)&lt;/label&gt;
         &lt;input id="ticket-&lt;%=ticketPrice.id%&gt;" data-tm-id="&lt;%=ticketPrice.id%&gt;" type="number" min="0" placeholder="Enter value"
               name="tickets"/&gt;
         &lt;span id="error-ticket-&lt;%=ticketPrice.id%&gt;" class="error" /&gt;
      &lt;/fieldset&gt;
   &lt;% }) %&gt;
   &lt;/form&gt;
&lt;% } %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before submitting the request to the server, the order is confirmed:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/mobile/confirm-booking.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;div data-role="header" data-position="fixed"&gt;
    &lt;a href="#" class="ui-btn ui-icon-home ui-btn-icon-left"&gt;Home&lt;/a&gt;
    &lt;h1&gt;Confirm order&lt;/h1&gt;
&lt;/div&gt;
&lt;div class="ui-content"&gt;
    &lt;h3&gt;&lt;%=show.event.name%&gt;&lt;/h3&gt;
    &lt;p&gt;&lt;%=show.venue.name%&gt;&lt;/p&gt;
    &lt;p&gt;&lt;small&gt;&lt;%=new Date(performance.date).toPrettyString()%&gt;&lt;/small&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Buyer:&lt;/strong&gt;  &lt;emphasis&gt;&lt;%=email%&gt;&lt;/emphasis&gt;&lt;/p&gt;
    &lt;div id="ticketSummaryView"/&gt;

&lt;/div&gt;

&lt;div data-role="footer" data-position="fixed"&gt;
    &lt;div class="ui-grid-b"&gt;
        &lt;div class="ui-block-a"&gt;&lt;a id="cancel" href="#" class="ui-btn ui-icon-delete ui-btn-icon-left block-btn"&gt;Cancel&lt;/a&gt;&lt;/div&gt;
        &lt;div class="ui-block-b"&gt;&lt;a id="goBack" class="ui-btn ui-icon-back ui-btn-icon-left block-btn"&gt;Back&lt;/a&gt;&lt;/div&gt;
        &lt;div class="ui-block-c"&gt;&lt;a id="saveBooking" class="ui-btn ui-btn-b ui-icon-check ui-btn-icon-left block-btn"&gt;Buy!&lt;/a&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The confirmation page contains a summary subview:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/mobile/ticket-summary-view.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;ul data-role="listview" data-split-icon="delete" data-split-theme="c" data-inset="true"&gt;
    &lt;% _.each(tickets, function(model) { %&gt;
    &lt;li&gt;
        &lt;a class="readonly-listview"&gt;
            &lt;p&gt;&lt;strong&gt;Section&lt;/strong&gt; &lt;%= model.ticketPrice.section.name %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;Category&lt;/strong&gt; &lt;%= model.ticketPrice.ticketCategory.description %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;Price&lt;/strong&gt; &lt;%= model.ticketPrice.price %&gt;&lt;/p&gt;
            &lt;p&gt;&lt;strong&gt;Quantity&lt;/strong&gt; &lt;%= model.quantity %&gt;&lt;/p&gt;
        &lt;/a&gt;
        &lt;a href="#" data-action="delete" data-ticketpriceid="&lt;%= model.ticketPrice.id %&gt;"&gt;&lt;/a&gt;
    &lt;/li&gt;
    &lt;% }); %&gt;
&lt;/ul&gt;
&lt;div&gt;
    &lt;h4&gt;Totals&lt;/h4&gt;
    &lt;p&gt;&lt;strong&gt;Total tickets: &lt;/strong&gt;&lt;%= totals.tickets %&gt;&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Total price: $ &lt;/strong&gt;&lt;%= totals.price %&gt;&lt;/p&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we create the page that displays the booking confirmation:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/templates/mobile/booking-details.html</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="html" class="language-html hljs">&lt;div data-role="header" data-position="fixed"&gt;
    &lt;a href="#" class="ui-btn ui-icon-home ui-btn-icon-left"&gt;Home&lt;/a&gt;
    &lt;h1&gt;Booking complete&lt;/h1&gt;
&lt;/div&gt;
&lt;div class="ui-content"&gt;
    &lt;table id="confirm_tbl"&gt;
        &lt;thead&gt;
        &lt;tr&gt;
            &lt;td colspan="5" align="center"&gt;&lt;strong&gt;Booking &lt;%=id%&gt;&lt;/strong&gt;&lt;/td&gt;
        &lt;tr&gt;
        &lt;tr&gt;
            &lt;th&gt;Ticket #&lt;/th&gt;
            &lt;th&gt;Category&lt;/th&gt;
            &lt;th&gt;Section&lt;/th&gt;
            &lt;th&gt;Row&lt;/th&gt;
            &lt;th&gt;Seat&lt;/th&gt;
        &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
        &lt;% $.each(_.sortBy(tickets, function(ticket) {return ticket.id}), function (i, ticket) { %&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;%= ticket.id %&gt;&lt;/td&gt;
            &lt;td&gt;&lt;%=ticket.ticketCategory.description%&gt;&lt;/td&gt;
            &lt;td&gt;&lt;%=ticket.seat.section.name%&gt;&lt;/td&gt;
            &lt;td&gt;&lt;%=ticket.seat.rowNumber%&gt;&lt;/td&gt;
            &lt;td&gt;&lt;%=ticket.seat.number%&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;% }) %&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;&lt;/div&gt;
&lt;div data-role="footer" data-position="fixed"&gt;

    &lt;div class="ui-block-b"&gt;
        &lt;a id="back" href="#" class="ui-btn ui-icon-back ui-btn-icon-left block-btn"&gt;Back&lt;/a&gt;
    &lt;/div&gt;

&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last step is registering the view with the router:</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/resources/js/app/router/mobile/router.js</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="javascript" class="language-javascript hljs">/**
 * A module for the router of the desktop application
 */
define("router", [
	...
    'app/views/mobile/create-booking',
    ...
],function (
			...
            CreateBookingView
            ...) {

    var Router = Backbone.Router.extend({
        ...
        routes:{
            ...
            "book/:showId/:performanceId":"bookTickets",
            ...
        },
        ...
        bookTickets:function (showId, performanceId) {
            var createBookingView = new CreateBookingView({model:{showId:showId, performanceId:performanceId, bookingRequest:{tickets:[]}}, el:$("#container")});
            utilities.viewManager.showView(createBookingView);
        },
        ...
        });
    ...
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The other use case: a booking starting from venues is conceptually similar, so you can just copy the rest of the logic from <code>src/main/webapp/resources/js/app/routers/mobile/router.js</code>, and the rest of the files files in the <code>src/main/webapp/resources/js/app/views/mobile</code> and <code>src/main/webapp/resources/templates/mobile</code> directories.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-03-04 07:05:48 -0500
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>