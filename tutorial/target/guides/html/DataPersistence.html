<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Pete Muir">
<title>Building the persistence layer with JPA2 and Bean Validation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Building the persistence layer with JPA2 and Bean Validation</h1>
<div class="details">
<span id="author" class="author">Pete Muir</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_what_will_you_learn_here">What will you learn here?</a></li>
<li><a href="#YourFirstEntity">Your first entity</a></li>
<li><a href="#_database_design_relationships">Database design &amp; relationships</a>
<ul class="sectlevel2">
<li><a href="#_media_items">Media items</a></li>
<li><a href="#_events">Events</a></li>
<li><a href="#_venue">Venue</a></li>
<li><a href="#_sections">Sections</a></li>
<li><a href="#_shows">Shows</a></li>
<li><a href="#_ticketprices">TicketPrices</a></li>
<li><a href="#_performances">Performances</a></li>
<li><a href="#_booking_ticket_seat">Booking, Ticket &amp; Seat</a></li>
<li><a href="#_sectionallocation_and_seatallocationexception">SectionAllocation and SeatAllocationException</a></li>
</ul>
</li>
<li><a href="#_connecting_to_the_database">Connecting to the database</a></li>
<li><a href="#_populating_test_data">Populating test data</a></li>
<li><a href="#_conclusion">Conclusion</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_what_will_you_learn_here">What will you learn here?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You have set up your project successfully. Now it is time to begin working on the TicketMonster
application, and the first step is adding the persistence layer. After reading this guide,
you&#8217;ll understand what design and implementation choices to make. Topics covered include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RDBMS design using JPA entity beans</p>
</li>
<li>
<p>How to validate your entities using Bean Validation</p>
</li>
<li>
<p>How to populate test data</p>
</li>
<li>
<p>Basic unit testing using JUnit</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#8217;ll round out the guide by revealing the required, yet short and sweet, configuration.</p>
</div>
<div class="paragraph">
<p>The tutorial will show you how to perform all these steps in JBoss Developer Studio, including
screenshots that guide you through. For those of you who prefer to watch and learn, the included
videos show you how we performed all the steps.</p>
</div>
<div class="paragraph">
<p>TicketMonster contains 14 entities, of varying complexity. In the introduction, you have seen
the basic steps for creating a couple of entities (<code>Event</code> and <code>Venue</code>) and interacting with them.
In this  tutorial we&#8217;ll go deeper into domain model design, we&#8217;ll classify the entities, and
walk through designing and creating one of each group.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="YourFirstEntity">Your first entity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simplest kind of entities are often those representing lookup tables. <code>TicketCategory</code> is a classic lookup table that defines the ticket types available (e.g. Adult, Child, Pensioner). A ticket category has one property - <em>description</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">What&#8217;s in a name?</div>
<div class="paragraph">
<p>Using a consistent naming scheme for your entities can help another developer get up
to speed with your code base. We&#8217;ve named all our lookup tables XXXCategory to allow
us to easily spot them.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s start by creating a JavaBean to represent the ticket category:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/TicketCategory.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class TicketCategory {

    /* Declaration of fields */

    /**
     * &lt;p&gt;
     * The description of the of ticket category.
     * &lt;/p&gt;
     *
     */
    private String description;

    /* Boilerplate getters and setters */

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    @Override
    public String toString() {
        return description;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re going to want to keep the ticket category in collections (for example, to present it as part of drop down in the UI), so it&#8217;s important that we properly implement <code>equals()</code> and <code>hashCode()</code>.  At this point, we need to define a property (or group of properties) that uniquely identifies the ticket category. We refer to these properties as the "entity&#8217;s natural identity".</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Defining an entity&#8217;s natural identity</div>
<div class="paragraph">
<p>Using an ORM introduces additional constraints on object identity. Defining the
properties that make up an entity&#8217;s natural identity can be tricky, but is very
important. Using the object&#8217;s identity, or the synthetic identity (database generated
primary key) identity can introduce unexpected bugs into your application, so you
should always ensure you use a natural identity. You can read more about the issue at
<a href="https://community.jboss.org/wiki/EqualsAndHashCode" class="bare">https://community.jboss.org/wiki/EqualsAndHashCode</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For ticket category, the choice of natural identity is easy and obvious - it must be the one property, <em>description</em> that the entity has! Having identified the natural identity, adding an <code>equals()</code> and <code>hashCode()</code> method is easy. In Eclipse, choose <em>Source &#8594; Generate hashCode() and equals()&#8230;&#8203;</em></p>
</div>
<div id="eclipse-generate-hashcode-equals" class="imageblock">
<div class="content">
<img src="gfx/eclipse-generate-hashcode-equals.png" alt="eclipse generate hashcode equals">
</div>
<div class="title">Figure 1. Generate hashCode() and equals() in Eclipse</div>
</div>
<div class="paragraph">
<p>Now, select the properties to include:</p>
</div>
<div id="eclipse-generate-hashcode-equals-2" class="imageblock">
<div class="content">
<img src="gfx/eclipse-generate-hashcode-equals-2.png" alt="eclipse generate hashcode equals 2">
</div>
<div class="title">Figure 2. Generate hashCode() and equals() in Eclipse</div>
</div>
<div class="paragraph">
<p>Now that we have a JavaBean, let&#8217;s proceed to make it an entity. First, add the <code>@Entity</code> annotation to the class:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/TicketCategory.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Entity
public class TicketCategory {

   ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, add the synthetic id:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/TicketCategory.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Entity
public class TicketCategory {

    /* Declaration of fields */

    /**
     * The synthetic id of the object.
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    ...

    /* Boilerplate getters and setters */

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we decided that our natural identifier was the <code>description</code>, we should introduce a unique constraint on the property:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/TicketCategory.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Entity
public class TicketCategory {

    /* Declaration of fields */

    ...

    /**
     * &lt;p&gt;
     * The description of the of ticket category.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The description forms the natural id of the ticket category, and so must be unique.
     * &lt;/p&gt;
     *
     */
    @Column(unique = true)
    private String description;

    ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s very important that any data you place in the database is of the highest quality - this data is probably one of your organisations most valuable assets! To ensure that bad data doesn&#8217;t get saved to the database by mistake, we&#8217;ll use Bean Validation to enforce constraints on our properties.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">What is Bean Validation?</div>
<div class="paragraph">
<p>Bean Validation (JSR 303) is a Java EE specification which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provides a unified way of declaring and defining constraints on an object model.</p>
</li>
<li>
<p>defines a runtime engine to validate objects</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bean Validation includes integration with other Java EE specifications, such as JPA.
Bean Validation constraints are automatically applied before data is persisted to the
database, as a last line of defence against bad data.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>description</em> of the ticket category should not be empty for two reasons. Firstly, an empty ticket category description is no use to a person trying to book a ticket - it doesn&#8217;t convey any information. Secondly, as the description forms the natural identity, we need to make sure the property is always populated.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add the Bean Validation constraint <code>@NotEmpty</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/TicketCategory.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Entity
public class TicketCategory {

    /* Declaration of fields */

    ...

    /**
     * &lt;p&gt;
     * The description of the of ticket category.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The description forms the natural id of the ticket category, and so must be unique.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The description must not be null and must be one or more characters, the Bean Validation constraint &lt;code&gt;@NotEmpty&lt;/code&gt;
     * enforces this.
     * &lt;/p&gt;
     *
     */
    @Column(unique = true)
    @NotEmpty
    private String description;

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that is our first entity! Here is the complete entity:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/TicketCategory.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/**
 * &lt;p&gt;
 * A lookup table containing the various ticket categories. E.g. Adult, Child, Pensioner, etc.
 * &lt;/p&gt;
 */
@Entity
public class TicketCategory {

    /* Declaration of fields */

    /**
     * The synthetic id of the object.
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * &lt;p&gt;
     * The description of the of ticket category.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The description forms the natural id of the ticket category, and so must be unique.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The description must not be null and must be one or more characters, the Bean Validation constraint &lt;code&gt;@NotEmpty&lt;/code&gt;
     * enforces this.
     * &lt;/p&gt;
     *
     */
    @Column(unique = true)
    @NotEmpty
    private String description;

    /* Boilerplate getters and setters */

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    /* toString(), equals() and hashCode() for TicketCategory, using the natural identity of the object */

    @Override
    public String toString() {
        return description;
    }

    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result
                + ((description == null) ? 0 : description.hashCode());
        return result;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj)
            return true;
        if (obj == null)
            return false;
        if (!(obj instanceof TicketCategory))
            return false;
        TicketCategory other = (TicketCategory) obj;
        if (description == null) {
            if (other.description != null)
                return false;
        } else if (!description.equals(other.description))
            return false;
        return true;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>TicketMonster contains another lookup tables, <code>EventCategory</code>. It&#8217;s pretty much identical to <code>TicketCategory</code>, so we leave it as an exercise to the reader to investigate, and understand. If you are building the application whilst following this tutorial, copy the source over from the TicketMonster example.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_database_design_relationships">Database design &amp; relationships</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, let&#8217;s understand the the entity design.</p>
</div>
<div class="paragraph">
<p>An <code>Event</code> may occur at any number of venues, on various days and at various times. The intersection between an event and a venue is a <code>Show</code>, and each show can have a <code>Performance</code> which is associated with a date and time.</p>
</div>
<div class="paragraph">
<p>Venues are a separate grouping of entities, which, as mentioned, intersect with events via shows. Each venue consists of groupings of seats, each known as a <code>Section</code>.</p>
</div>
<div class="paragraph">
<p>Every section, in every show is associated with a ticket category via the <code>TicketPrice</code> entity.</p>
</div>
<div class="paragraph">
<p>Users must be able to book tickets for performances. A <code>Booking</code> is associated with a performance, and contains a collection of tickets.</p>
</div>
<div class="paragraph">
<p>Finally, both events and venues can have "media items", such as images or videos attached.</p>
</div>
<div id="database-design" class="imageblock">
<div class="content">
<img src="gfx/database-design.png" alt="database design">
</div>
<div class="title">Figure 3. Entity-Relationship Diagram</div>
</div>
<div class="sect2">
<h3 id="_media_items">Media items</h3>
<div class="paragraph">
<p>Storing large binary objects, such as images or videos in the database isn&#8217;t advisable (as it can lead to performance issues), and playback of videos can also be tricky, as it depends on browser capabilities. For TicketMonster, we decided to make use of existing services to host images and videos, such as YouTube or Flickr. All we store in the database is the URL the application should use to access the media item, and the type of the media item (note that the URL forms a media items natural identifier). We need to know the type of the media item in order to render the media correctly in the view layer.</p>
</div>
<div class="paragraph">
<p>In order for a view layer to correctly render the media item (e.g. display an image, embed a media player), it&#8217;s likely that special code has had to have been added. For this reason we represent the types of media that TicketMonster understands as a closed set, unmodifiable at runtime. An enum is perfect for this!</p>
</div>
<div class="paragraph">
<p>Luckily, JPA has native support for enums, all we need to do is add the <code>@Enumerated</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/MediaItem.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">    ...

    /**
     * &lt;p&gt;
     * The type of the media, required to render the media item correctly.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The media type is a &lt;em&gt;closed set&lt;/em&gt; - as each different type of media requires support coded into the view layers, it
     * cannot be expanded upon without rebuilding the application. It is therefore represented by an enumeration. We instruct
     * JPA to store the enum value using it's String representation, so that we can later reorder the enum members, without
     * changing the data. Of course, this does mean we can't change the names of media items once the app is put into
     * production.
     * &lt;/p&gt;
     */
    @Enumerated(STRING)
    private MediaType mediaType;

    ...</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">@Enumerated(STRING) or @Enumerated(ORDINAL)?</div>
<div class="paragraph">
<p>JPA can store an enum value using it&#8217;s ordinal (position in the list of declared enums)
or it&#8217;s STRING (the name it is given). If you choose to store an ordinal, you musn&#8217;t alter
the order of the list. If you choose to store the name, you musn&#8217;t change the enum name.
The choice is yours!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The rest of <code>MediaItem</code> shouldn&#8217;t present a challenge to you. If you are building the application whilst following this tutorial, copy both <code>MediaItem</code> and <code>MediaType</code> from the TicketMonster project.</p>
</div>
</div>
<div class="sect2">
<h3 id="_events">Events</h3>
<div class="paragraph">
<p>In the section <a href="#YourFirstEntity">Your first entity</a>, we saw how to build simple entities with properties, identify and apply constraints using Bean Validation, identify the natural id and add a synthetic id. From now on we&#8217;ll assume you know how to build simple entities - for each new entity that we build, we will start with it&#8217;s basic structure and properties filled in.</p>
</div>
<div class="paragraph">
<p>So, here we modify the Event class (from where we left at the end of the introduction). The below listing also includes some comments reflecting the explanations above. We will remove a few fields - <code>version</code>, <code>major</code> and <code>picture</code>, update the annotations on the <code>id</code> field, and update the <code>toString</code>, <code>equals</code> and <code>hashCode</code> methods to use the natural key of the object):</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Event.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Entity
public class Event {

    /* Declaration of fields */

    /**
     * The synthetic ID of the object.
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * &lt;p&gt;
     * The name of the event.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The name of the event forms it's natural identity and cannot be shared between events.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * Two constraints are applied using Bean Validation
     * &lt;/p&gt;
     *
     * &lt;ol&gt;
     * &lt;li&gt;&lt;code&gt;@NotNull&lt;/code&gt; &amp;mdash; the name must not be null.&lt;/li&gt;
     * &lt;li&gt;&lt;code&gt;@Size&lt;/code&gt; &amp;mdash; the name must be at least 5 characters and no more than 50 characters. This allows for
     * better formatting consistency in the view layer.&lt;/li&gt;
     * &lt;/ol&gt;
     */
    @Column(unique = true)
    @NotNull
    @Size(min = 5, max = 50, message = "An event's name must contain between 5 and 50 characters")
    private String name;

    /**
     * &lt;p&gt;
     * A description of the event.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * Two constraints are applied using Bean Validation
     * &lt;/p&gt;
     *
     * &lt;ol&gt;
     * &lt;li&gt;&lt;code&gt;@NotNull&lt;/code&gt; &amp;mdash; the description must not be null.&lt;/li&gt;
     * &lt;li&gt;&lt;code&gt;@Size&lt;/code&gt; &amp;mdash; the name must be at least 20 characters and no more than 1000 characters. This allows for
     * better formatting consistency in the view layer, and also ensures that event organisers provide at least some description
     * - a classic example of a business constraint.&lt;/li&gt;
     * &lt;/ol&gt;
     */
    @NotNull
    @Size(min = 20, max = 1000, message = "An event's description must contain between 20 and 1000 characters")
    private String description;


    /* Boilerplate getters and setters */

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    /* toString(), equals() and hashCode() for Event, using the natural identity of the object */

    @Override
    public boolean equals(Object o) {
        if (this == o)
            return true;
        if (o == null || getClass() != o.getClass())
            return false;

        Event event = (Event) o;

        if (name != null ? !name.equals(event.name) : event.name != null)
            return false;

        return true;
    }

    @Override
    public int hashCode() {
        return name != null ? name.hashCode() : 0;
    }

    @Override
    public String toString() {
        return name;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First, let&#8217;s add a media item to <code>Event</code>. As multiple events (or venues) could share the same media item, we&#8217;ll model the relationship as <em>many-to-one</em> - many events can reference the same media item.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Relationships supported by JPA</div>
<div class="paragraph">
<p>JPA can model four types of relationship between entities - one-to-one, one-to-many,
many-to-one and many-to-many. A relationship may be bi-directional (both sides of the
relationship know about each other) or uni-directional (only one side knows about the
relationship).</p>
</div>
<div class="paragraph">
<p>Many database models are hierarchical (parent-child), as is TicketMonster&#8217;s. As a result,
you&#8217;ll probably find you mostly use one-to-many and many-to-one relationships, which
allow building parent-child models.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Creating a many-to-one relationship is very easy in JPA. Just add the <code>@ManyToOne</code> annotation to the field. JPA will take care of the rest. Here&#8217;s the property for <code>Event</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Event.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">    ...

    /**
     * &lt;p&gt;
     * A media item, such as an image, which can be used to entice a browser to book a ticket.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * Media items can be shared between events, so this is modeled as a &lt;code&gt;@ManyToOne&lt;/code&gt; relationship.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * Adding a media item is optional, and the view layer will adapt if none is provided.
     * &lt;/p&gt;
     *
     */
    @ManyToOne
    private MediaItem mediaItem;

    ...

    public MediaItem getMediaItem() {
        return mediaItem;
    }

    public void setMediaItem(MediaItem picture) {
        this.mediaItem = picture;
    }

    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no need for a media item to know who references it (in fact, this would be a poor design, as it would reduce the reusability of <code>MediaItem</code>), so we can leave this as a uni-directional relationship.</p>
</div>
<div class="paragraph">
<p>An event will also have a category. Once again, many events can belong to the same event category, and there is no need for an event category to know what events are in it. To add this relationship, we add the <code>eventCategory</code> property, and annotate it with <code>@ManyToOne</code>, just as we did for <code>MediaItem</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Event.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">    ...

    /**
     * &lt;p&gt;
     * The category of the event
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * Event categories are used to ease searching of available of events, and hence this is modeled as a relationship
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The Bean Validation constraint &lt;code&gt;@NotNull&lt;/code&gt; indicates that the event category must be specified.
     */
    @ManyToOne
    @NotNull
    private EventCategory category;

    ...

    public EventCategory getCategory() {
        return category;
    }

    public void setCategory(EventCategory category) {
        this.category = category;
    }

    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that&#8217;s Event created. Here is the full source:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Event.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/**
 * &lt;p&gt;
 * Represents an event, which may have multiple performances with different dates and venues.
 * &lt;/p&gt;
 *
 * &lt;p&gt;
 * Event's principal members are it's relationship to {@link EventCategory} - specifying the type of event it is - and
 * {@link MediaItem} - providing the ability to add media (such as a picture) to the event for display. It also contains
 * meta-data about the event, such as it's name and a description.
 * &lt;/p&gt;
 *
 */
@Entity
public class Event {

    /* Declaration of fields */

    /**
     * The synthetic ID of the object.
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * &lt;p&gt;
     * The name of the event.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The name of the event forms it's natural identity and cannot be shared between events.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * Two constraints are applied using Bean Validation
     * &lt;/p&gt;
     *
     * &lt;ol&gt;
     * &lt;li&gt;&lt;code&gt;@NotNull&lt;/code&gt; &amp;mdash; the name must not be null.&lt;/li&gt;
     * &lt;li&gt;&lt;code&gt;@Size&lt;/code&gt; &amp;mdash; the name must be at least 5 characters and no more than 50 characters. This allows for
     * better formatting consistency in the view layer.&lt;/li&gt;
     * &lt;/ol&gt;
     */
    @Column(unique = true)
    @NotNull
    @Size(min = 5, max = 50, message = "An event's name must contain between 5 and 50 characters")
    private String name;

    /**
     * &lt;p&gt;
     * A description of the event.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * Two constraints are applied using Bean Validation
     * &lt;/p&gt;
     *
     * &lt;ol&gt;
     * &lt;li&gt;&lt;code&gt;@NotNull&lt;/code&gt; &amp;mdash; the description must not be null.&lt;/li&gt;
     * &lt;li&gt;&lt;code&gt;@Size&lt;/code&gt; &amp;mdash; the name must be at least 20 characters and no more than 1000 characters. This allows for
     * better formatting consistency in the view layer, and also ensures that event organisers provide at least some description
     * - a classic example of a business constraint.&lt;/li&gt;
     * &lt;/ol&gt;
     */
    @NotNull
    @Size(min = 20, max = 1000, message = "An event's name must contain between 20 and 1000 characters")
    private String description;

    /**
     * &lt;p&gt;
     * A media item, such as an image, which can be used to entice a browser to book a ticket.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * Media items can be shared between events, so this is modeled as a &lt;code&gt;@ManyToOne&lt;/code&gt; relationship.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * Adding a media item is optional, and the view layer will adapt if none is provided.
     * &lt;/p&gt;
     *
     */
    @ManyToOne
    private MediaItem mediaItem;

    /**
     * &lt;p&gt;
     * The category of the event
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * Event categories are used to ease searching of available of events, and hence this is modeled as a relationship
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The Bean Validation constraint &lt;code&gt;@NotNull&lt;/code&gt; indicates that the event category must be specified.
     */
    @ManyToOne
    @NotNull
    private EventCategory category;

    /* Boilerplate getters and setters */

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public MediaItem getMediaItem() {
        return mediaItem;
    }

    public void setMediaItem(MediaItem picture) {
        this.mediaItem = picture;
    }

    public EventCategory getCategory() {
        return category;
    }

    public void setCategory(EventCategory category) {
        this.category = category;
    }

    /* toString(), equals() and hashCode() for Event, using the natural identity of the object */

    @Override
    public boolean equals(Object o) {
        if (this == o)
            return true;
        if (o == null || getClass() != o.getClass())
            return false;

        Event event = (Event) o;

        if (name != null ? !name.equals(event.name) : event.name != null)
            return false;

        return true;
    }

    @Override
    public int hashCode() {
        return name != null ? name.hashCode() : 0;
    }

    @Override
    public String toString() {
        return name;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_venue">Venue</h3>
<div class="paragraph">
<p>Now, let&#8217;s build out the entities to represent the venue.</p>
</div>
<div class="paragraph">
<p>We start by adding an entity to represent the venue. A venue needs to have a name, a description,
a capacity, an address, an associated media item and a set of sections in which people can sit.  If
you completed the introduction chapter, you should already have some of these properties set, so
we will update the <code>Venue</code> class to look like in the definition below.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Venue.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/**
 * &lt;p&gt;
 * Represents a single venue
 * &lt;/p&gt;
 *
 */
@Entity
public class Venue {

    /* Declaration of fields */

    /**
     * The synthetic id of the object.
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * &lt;p&gt;
     * The name of the event.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The name of the event forms it's natural identity and cannot be shared between events.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The name must not be null and must be one or more characters, the Bean Validation
     * constraint &lt;code&gt;@NotEmpty&lt;/code&gt; enforces this.
     * &lt;/p&gt;
     */
    @Column(unique = true)
    @NotEmpty
    private String name;

    /**
     * The address of the venue
     */
    @Embedded
    private Address address = new Address();

    /**
     * A description of the venue
     */
    private String description;

    /**
     * &lt;p&gt;
     * A set of sections in the venue
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@OneToMany&lt;code&gt; JPA mapping establishes this relationship.
     * Collection members are fetched eagerly, so that they can be accessed even after the
     * entity has become detached. This relationship is bi-directional (a section knows which
     * venue it is part of), and the &lt;code&gt;mappedBy&lt;/code&gt; attribute establishes this. We
     * cascade all persistence operations to the set of performances, so, for example if a venue
     * is removed, then all of it's sections will also be removed.
     * &lt;/p&gt;
     */
    @OneToMany(cascade = ALL, fetch = EAGER, mappedBy = "venue")
    private Set&lt;Section&gt; sections = new HashSet&lt;Section&gt;();

    /**
     * The capacity of the venue
     */
    private int capacity;

    /**
     * An optional media item to entice punters to the venue. The &lt;code&gt;@ManyToOne&lt;/code&gt; establishes the relationship.
     */
    @ManyToOne
    private MediaItem mediaItem;

    /* Boilerplate getters and setters */

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Address getAddress() {
        return address;
    }

    public void setAddress(Address address) {
        this.address = address;
    }

    public MediaItem getMediaItem() {
        return mediaItem;
    }

    public void setMediaItem(MediaItem description) {
        this.mediaItem = description;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public Set&lt;Section&gt; getSections() {
        return sections;
    }

    public void setSections(Set&lt;Section&gt; sections) {
        this.sections = sections;
    }

    public int getCapacity() {
        return capacity;
    }

    public void setCapacity(int capacity) {
        this.capacity = capacity;
    }

    /* toString(), equals() and hashCode() for Venue, using the natural identity of the object */

    @Override
    public boolean equals(Object o) {
        if (this == o)
            return true;
        if (o == null || getClass() != o.getClass())
            return false;

        Venue venue = (Venue) o;

        if (address != null ? !address.equals(venue.address) : venue.address != null)
            return false;
        if (name != null ? !name.equals(venue.name) : venue.name != null)
            return false;

        return true;
    }

    @Override
    public int hashCode() {
        int result = name != null ? name.hashCode() : 0;
        result = 31 * result + (address != null ? address.hashCode() : 0);
        return result;
    }

    @Override
    public String toString() {
        return name;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In creating this entity, we&#8217;ve followed all the design and implementation decisions previously discussed, with one new concept. Rather than add the properties for street, city, postal code etc. to this object, we&#8217;ve extracted them into the <code>Address</code> object, and included it in the <code>Venue</code> object using composition. This would allow us to reuse the Address object in other places (such as a customer&#8217;s address).</p>
</div>
<div class="paragraph">
<p>A RDBMS doesn&#8217;t have a similar concept to composition, so we need to choose whether to represent the address as a separate entity, and create a relationship between the venue and the address, or whether to map the properties from <code>Address</code> to the table for the owning entity, in this case <code>Venue</code>. It doesn&#8217;t make much sense for an address to be a full entity - we&#8217;re not going to want to run queries against the address in isolation, nor do we want to be able to delete or update an address in isolation - in essence, the address doesn&#8217;t have a standalone identity outside of the object into which it is composed.</p>
</div>
<div class="paragraph">
<p>To <em>embed</em> the <code>Address</code> into <code>Venue</code> we add the <code>@Embeddable</code> annotation to the <code>Address</code> class. However, unlike a full entity, there is no need to add an identifier. Here&#8217;s the source for <code>Address</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Address.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/**
 * &lt;p&gt;
 * A reusable representation of an address.
 * &lt;/p&gt;
 *
 * &lt;p&gt;
 * Addresses are used in many places in an application, so to observe the DRY principle, we model Address as an embeddable
 * entity. An embeddable entity appears as a child in the object model, but no relationship is established in the RDBMS..
 * &lt;/p&gt;
 */
@Embeddable
public class Address {

    /* Declaration of fields */
    private String street;
    private String city;
    private String country;

    /* Declaration of boilerplate getters and setters */

    public String getStreet() {
        return street;
    }

    public void setStreet(String street) {
        this.street = street;
    }

    public String getCity() {
        return city;
    }

    public void setCity(String city) {
        this.city = city;
    }

    public String getCountry() {
        return country;
    }

    public void setCountry(String country) {
        this.country = country;
    }

    /* toString(), equals() and hashCode() for Address, using the natural identity of the object */

    @Override
    public boolean equals(Object o) {
        if (this == o)
            return true;
        if (o == null || getClass() != o.getClass())
            return false;

        Address address = (Address) o;

        if (city != null ? !city.equals(address.city) : address.city != null)
            return false;
        if (country != null ? !country.equals(address.country) : address.country != null)
            return false;
        if (street != null ? !street.equals(address.street) : address.street != null)
            return false;

        return true;
    }

    @Override
    public int hashCode() {
        int result = street != null ? street.hashCode() : 0;
        result = 31 * result + (city != null ? city.hashCode() : 0);
        result = 31 * result + (country != null ? country.hashCode() : 0);
        return result;
    }

    @Override
    public String toString() {
        return street + ", " + city + ", " + country;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sections">Sections</h3>
<div class="paragraph">
<p>A venue consists of a number of seating sections. Each seating section has a name, a description, the number of rows in the section, and the number of seats in a row. It&#8217;s natural identifier is the name of section combined with the venue (a venue can&#8217;t have two sections with the same name). <code>Section</code> doesn&#8217;t introduce any new concepts, so go ahead and copy the source from the below listing:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Section.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@SuppressWarnings("serial")
@Entity
@Table(uniqueConstraints=@UniqueConstraint(columnNames={"name", "venue_id"}))
public class Section implements Serializable {

    /* Declaration of fields */

    /**
     * The synthetic id of the object.
     */
    @Id
    @GeneratedValue(strategy = IDENTITY)
    private Long id;

    /**
     * &lt;p&gt;
     * The short name of the section, may be a code such as A12, G7, etc.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The
     * &lt;code&gt;@NotEmpty&lt;code&gt; Bean Validation constraint means that the section name must be at least 1 character.
     * &lt;/p&gt;
     */
    @NotEmpty
    private String name;

    /**
     * &lt;p&gt;
     * The description of the section, such as 'Rear Balcony', etc.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The
     * &lt;code&gt;@NotEmpty&lt;code&gt; Bean Validation constraint means that the section description must be at least 1 character.
     * &lt;/p&gt;
     */
    @NotEmpty
    private String description;

    /**
     * &lt;p&gt;
     * The venue to which this section belongs. The &lt;code&gt;@ManyToOne&lt;code&gt; JPA mapping establishes this relationship.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@NotNull&lt;/code&gt; Bean Validation constraint means that the venue must be specified.
     * &lt;/p&gt;
     */
    @ManyToOne
    @NotNull
    private Venue venue;

    /**
     * The number of rows that make up the section.
     */
    private int numberOfRows;

    /**
     * The number of seats in a row.
     */
    private int rowCapacity;

    /* Boilerplate getters and setters */

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public int getNumberOfRows() {
        return numberOfRows;
    }

    public void setNumberOfRows(int numberOfRows) {
        this.numberOfRows = numberOfRows;
    }

    public int getRowCapacity() {
        return rowCapacity;
    }

    public void setRowCapacity(int rowCapacity) {
        this.rowCapacity = rowCapacity;
    }

    public int getCapacity() {
        return this.rowCapacity * this.numberOfRows;
    }

    public Venue getVenue() {
        return venue;
    }

    public void setVenue(Venue venue) {
        this.venue = venue;
    }

    /* toString(), equals() and hashCode() for Section, using the natural identity of the object */

    @Override
    public boolean equals(Object o) {
        if (this == o)
            return true;
        if (o == null || getClass() != o.getClass())
            return false;

        Section section = (Section) o;

        if (venue != null ? !venue.equals(section.venue) : section.venue != null)
            return false;
        if (name != null ? !name.equals(section.name) : section.name != null)
            return false;

        return true;
    }

    @Override
    public int hashCode() {
        int result = name != null ? name.hashCode() : 0;
        result = 31 * result + (venue != null ? venue.hashCode() : 0);
        return result;
    }

    @Override
    public String toString() {
        return name;
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_shows">Shows</h3>
<div class="paragraph">
<p>A show is an event at a venue. It consists of a set of performances of the show. A show also contains the list of ticket prices available.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start building Show. Here&#8217;s is our starting point:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Show.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/**
 * &lt;p&gt;
 * A show is an instance of an event taking place at a particular venue. A show can have multiple performances.
 * &lt;/p&gt;
 */
@Entity
public class Show {

    /* Declaration of fields */

    /**
     * The synthetic id of the object.
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * &lt;p&gt;
     * The event of which this show is an instance. The &lt;code&gt;@ManyToOne&lt;code&gt; JPA mapping establishes this relationship.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@NotNull&lt;/code&gt; Bean Validation constraint means that the event must be specified.
     * &lt;/p&gt;
     */
    @ManyToOne
    @NotNull
    private Event event;

    /**
     * &lt;p&gt;
     * The venue where this show takes place. The &lt;code&gt;@ManyToOne&lt;code&gt; JPA mapping establishes this relationship.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@NotNull&lt;/code&gt; Bean Validation constraint means that the venue must be specified.
     * &lt;/p&gt;
     */
    @ManyToOne
    @NotNull
    private Venue venue;

    /* Boilerplate getters and setters */

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public Event getEvent() {
        return event;
    }

    public void setEvent(Event event) {
        this.event = event;
    }

    public Venue getVenue() {
        return venue;
    }

    public void setVenue(Venue venue) {
        this.venue = venue;
    }

    /* toString(), equals() and hashCode() for Show, using the natural identity of the object */
    @Override
    public boolean equals(Object o) {
        if (this == o)
            return true;
        if (o == null || getClass() != o.getClass())
            return false;

        Show show = (Show) o;

        if (event != null ? !event.equals(show.event) : show.event != null)
            return false;
        if (venue != null ? !venue.equals(show.venue) : show.venue != null)
            return false;

        return true;
    }

    @Override
    public int hashCode() {
        int result = event != null ? event.hashCode() : 0;
        result = 31 * result + (venue != null ? venue.hashCode() : 0);
        return result;
    }

    @Override
    public String toString() {
        return event + " at " + venue;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;ve been paying attention, you&#8217;ll notice that there is a problem here. We&#8217;ve identified that the natural identity of this entity is formed of two properties - the <em>event</em> and the <em>venue</em>, and we&#8217;ve correctly coded the <code>equals()</code> and <code>hashCode()</code> methods (or had them generated for us!). However, we haven&#8217;t told JPA that these two properties, in combination, must be unique. As there are two properties involved, we can no longer use the <code>@Column</code> annotation (which operates on a single property/table column), but now must use the class level <code>@Table</code> annotation (which operates on the whole entity/table). Change the class definition to read:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Show.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">...

@Entity
@Table(uniqueConstraints = @UniqueConstraint(columnNames = { "event_id", "venue_id" }))
public class Show {

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll notice that JPA requires us to use the column names, rather than property names here. The column names used in the <code>@UniqueConstraint</code> annotation are those generated by default for properties called <code>event</code> and <code>venue</code>.</p>
</div>
<div class="paragraph">
<p>Additionally, <code>Show</code> is a reserved word in certain databases, most notable MySQL. We&#8217;ll specify a different table name as a result, so that Hibernate will generate correct DDL statements:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Show.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">...

@Entity
@Table(name="Appearance", uniqueConstraints = @UniqueConstraint(columnNames = { "event_id", "venue_id" }))
public class Show {

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s add the set of performances to the event. Unlike previous relationships we&#8217;ve seen, the relationship between a show and it&#8217;s performances is bi-directional. We chose to model this as a bi-directional relationship in order to improve the generated database schema (otherwise you end with complicated mapping tables which makes updates to collections hard). Let&#8217;s add the set of performances:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Show.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">    ...

    /**
     * &lt;p&gt;
     * The set of performances of this show.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@OneToMany&lt;code&gt; JPA mapping establishes this relationship. Collection members
     * are fetched eagerly, so that they can be accessed even after the entity has become detached.
     * This relationship is bi-directional (a performance knows which show it is part of), and the &lt;code&gt;mappedBy&lt;/code&gt;
     * attribute establishes this.
     * &lt;/p&gt;
     *
     */
    @OneToMany(fetch=EAGER, mappedBy = "show", cascade = ALL)
    @OrderBy("date")
    private Set&lt;Performance&gt; performances = new HashSet&lt;Performance&gt;();

    ...

    public Set&lt;Performance&gt; getPerformances() {
        return performances;
    }

    public void setPerformances(Set&lt;Performance&gt; performances) {
        this.performances = performances;
    }

    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the relationship is bi-directional, we specify the <code>mappedBy</code> attribute on the <code>@OneToMany</code> annotation, which informs JPA to create a bi-directional relationship. The value of the attribute is name of property which forms the other side of the relationship - in this case, not unsuprisingly <code>show</code>!</p>
</div>
<div class="paragraph">
<p>As <code>Show</code> is the owner of <code>Performance</code> (and without a show, a performance cannot exist), we add the <code>cascade = ALL</code> attribute to the <code>@OneToMany</code> annotation. As a result, any persistence operation that occurs on a show, will be propagated to it&#8217;s performances. For example, if a show is removed, any associated performances will be removed as well.</p>
</div>
<div class="paragraph">
<p>When retrieving a show, we will also retrieve its associated performances by adding the <code>fetch = EAGER</code> attribute to the <code>@OneToMany</code> annotation. This is a design decision which required careful consideration. In general, you should favour the default lazy initialization of collections: their content should be accessible on demand. However, in this case we intend to marshal the contents of the collection and pass it across the wire in the JAX-RS layer, after the entity has become detached, and cannot initialize its members on demand.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll also need to add the set of ticket prices available for this show. Once more, this is a bi-directional relationship, owned by the show. It looks just like the set of performances:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Show.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">    ...

    /**
     * &lt;p&gt;
     * The set of ticket prices available for this show.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@OneToMany&lt;code&gt; JPA mapping establishes this relationship.
     * This relationship is bi-directional (a ticket price category knows which show it is part of), and the &lt;code&gt;mappedBy&lt;/code&gt;
     * attribute establishes this. We cascade all persistence operations to the set of performances, so, for example if a show
     * is removed, then all of it's ticket price categories are also removed.
     * &lt;/p&gt;
     */
    @OneToMany(mappedBy = "show", cascade = CascadeType.ALL, fetch = FetchType.EAGER)
    private Set&lt;TicketPrice&gt; ticketPrices = new HashSet&lt;TicketPrice&gt;();

    ...

    public Set&lt;TicketPrice&gt; getTicketPrices() {
        return ticketPrices;
    }

    public void setTicketPrices(Set&lt;TicketPrice&gt; ticketPrices) {
        this.ticketPrices = ticketPrices;
    }

    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the full source for <code>Show</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Show.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/**
 * &lt;p&gt;
 * A show is an instance of an event taking place at a particular venue. A show can have multiple performances.
 * &lt;/p&gt;
 *
 * &lt;p&gt;
 * A show contains a set of performances, and a set of ticket prices for each section of the venue for this show.
 * &lt;/p&gt;
 *
 * &lt;p&gt;
 * The event and venue form the natural id of this entity, and therefore must be unique. JPA requires us to use the class level
 * &lt;code&gt;@Table&lt;/code&gt; constraint.
 * &lt;/p&gt;
 *
 */
/*
 * We suppress the warning about not specifying a serialVersionUID, as we are still developing this app, and want the JVM to
 * generate the serialVersionUID for us. When we put this app into production, we'll generate and embed the serialVersionUID
 */
@SuppressWarnings("serial")
@Entity
@Table(name="Appearance", uniqueConstraints = @UniqueConstraint(columnNames = { "event_id", "venue_id" }))
public class Show implements Serializable {

    /* Declaration of fields */

    /**
     * The synthetic id of the object.
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * &lt;p&gt;
     * The event of which this show is an instance. The &lt;code&gt;@ManyToOne&lt;code&gt; JPA mapping establishes this relationship.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@NotNull&lt;/code&gt; Bean Validation constraint means that the event must be specified.
     * &lt;/p&gt;
     */
    @ManyToOne
    @NotNull
    private Event event;

    /**
     * &lt;p&gt;
     * The event of which this show is an instance. The &lt;code&gt;@ManyToOne&lt;code&gt; JPA mapping establishes this relationship.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@NotNull&lt;/code&gt; Bean Validation constraint means that the event must be specified.
     * &lt;/p&gt;
     */
    @ManyToOne
    @NotNull
    private Venue venue;

    /**
     * &lt;p&gt;
     * The set of performances of this show.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@OneToMany&lt;code&gt; JPA mapping establishes this relationship. TODO Explain EAGER fetch.
     * This relationship is bi-directional (a performance knows which show it is part of), and the &lt;code&gt;mappedBy&lt;/code&gt;
     * attribute establishes this. We cascade all persistence operations to the set of performances, so, for example if a show
     * is removed, then all of it's performances will also be removed.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * Normally a collection is loaded from the database in the order of the rows, but here we want to make sure that
     * performances are ordered by date - we let the RDBMS do the heavy lifting. The
     * &lt;code&gt;@OrderBy&lt;code&gt; annotation instructs JPA to do this.
     * &lt;/p&gt;
     */
    @OneToMany(fetch = EAGER, mappedBy = "show", cascade = ALL)
    @OrderBy("date")
    private Set&lt;Performance&gt; performances = new HashSet&lt;Performance&gt;();

    /**
     * &lt;p&gt;
     * The set of ticket prices available for this show.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@OneToMany&lt;code&gt; JPA mapping establishes this relationship.
     * This relationship is bi-directional (a ticket price category knows which show it is part of), and the &lt;code&gt;mappedBy&lt;/code&gt;
     * attribute establishes this. We cascade all persistence operations to the set of performances, so, for example if a show
     * is removed, then all of it's ticket price categories are also removed.
     * &lt;/p&gt;
     */
    @OneToMany(mappedBy = "show", cascade = ALL, fetch = EAGER)
    private Set&lt;TicketPrice&gt; ticketPrices = new HashSet&lt;TicketPrice&gt;();

    /* Boilerplate getters and setters */

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public Event getEvent() {
        return event;
    }

    public void setEvent(Event event) {
        this.event = event;
    }

    public Venue getVenue() {
        return venue;
    }

    public void setVenue(Venue venue) {
        this.venue = venue;
    }

    public Set&lt;Performance&gt; getPerformances() {
        return performances;
    }

    public void setPerformances(Set&lt;Performance&gt; performances) {
        this.performances = performances;
    }

    public Set&lt;TicketPrice&gt; getTicketPrices() {
        return ticketPrices;
    }

    public void setTicketPrices(Set&lt;TicketPrice&gt; ticketPrices) {
        this.ticketPrices = ticketPrices;
    }

    /* toString(), equals() and hashCode() for Show, using the natural identity of the object */
    @Override
    public boolean equals(Object o) {
        if (this == o)
            return true;
        if (o == null || getClass() != o.getClass())
            return false;

        Show show = (Show) o;

        if (event != null ? !event.equals(show.event) : show.event != null)
            return false;
        if (venue != null ? !venue.equals(show.venue) : show.venue != null)
            return false;

        return true;
    }

    @Override
    public int hashCode() {
        int result = event != null ? event.hashCode() : 0;
        result = 31 * result + (venue != null ? venue.hashCode() : 0);
        return result;
    }

    @Override
    public String toString() {
        return event + " at " + venue;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ticketprices">TicketPrices</h3>
<div class="paragraph">
<p>The <code>Show</code> entity references two classes - <code>TicketPrice</code> and <code>Performance</code>, that are not yet created. Let&#8217;s first create the <code>TicketPrice</code> class which represents the price for a ticket in a particular <code>Section</code> at a <code>Show</code> for a specific <code>TicketCategory</code>. It does not introduce any new concepts, so go ahead and copy the source from the below listing:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/TicketPrice.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/**
 * &lt;p&gt;
 * Contains price categories - each category represents the price for a ticket in a particular section at a particular venue for
 * a particular event, for a particular ticket category.
 * &lt;/p&gt;
 *
 * &lt;p&gt;
 * The section, show and ticket category form the natural id of this entity, and therefore must be unique. JPA requires us to use the class level
 * &lt;code&gt;@Table&lt;/code&gt; constraint
 * &lt;/p&gt;
 *
 */
/*
 * We suppress the warning about not specifying a serialVersionUID, as we are still developing this app, and want the JVM to
 * generate the serialVersionUID for us. When we put this app into production, we'll generate and embed the serialVersionUID
 */
@SuppressWarnings("serial")
@Entity
@Table(uniqueConstraints = @UniqueConstraint(columnNames = { "section_id", "show_id", "ticketcategory_id" }))
public class TicketPrice implements Serializable {

    /* Declaration of fields */

    /**
     * The synthetic id of the object.
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * &lt;p&gt;
     * The show to which this ticket price category belongs. The &lt;code&gt;@ManyToOne&lt;code&gt; JPA mapping establishes this relationship.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@NotNull&lt;/code&gt; Bean Validation constraint means that the show must be specified.
     * &lt;/p&gt;
     */
    @ManyToOne
    @NotNull
    private Show show;

    /**
     * &lt;p&gt;
     * The section to which this ticket price category belongs. The &lt;code&gt;@ManyToOne&lt;code&gt; JPA mapping establishes this relationship.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@NotNull&lt;/code&gt; Bean Validation constraint means that the section must be specified.
     * &lt;/p&gt;
     */
    @ManyToOne
    @NotNull
    private Section section;

    /**
     * &lt;p&gt;
     * The ticket category to which this ticket price category belongs. The &lt;code&gt;@ManyToOne&lt;code&gt; JPA mapping establishes this relationship.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The &lt;code&gt;@NotNull&lt;/code&gt; Bean Validation constraint means that the ticket category must be specified.
     * &lt;/p&gt;
     */
    @ManyToOne
    @NotNull
    private TicketCategory ticketCategory;

    /**
     * The price for this category of ticket.
     */
    private float price;

    /* Boilerplate getters and setters */

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public Show getShow() {
        return show;
    }

    public void setShow(Show show) {
        this.show = show;
    }

    public Section getSection() {
        return section;
    }

    public void setSection(Section section) {
        this.section = section;
    }

    public TicketCategory getTicketCategory() {
        return ticketCategory;
    }

    public void setTicketCategory(TicketCategory ticketCategory) {
        this.ticketCategory = ticketCategory;
    }

    public float getPrice() {
        return price;
    }

    public void setPrice(float price) {
        this.price = price;
    }

    /* equals() and hashCode() for TicketPrice, using the natural identity of the object */

    @Override
    public boolean equals(Object o) {
        if (this == o)
            return true;
        if (o == null || getClass() != o.getClass())
            return false;

        TicketPrice that = (TicketPrice) o;

        if (section != null ? !section.equals(that.section) : that.section != null)
            return false;
        if (show != null ? !show.equals(that.show) : that.show != null)
            return false;
        if (ticketCategory != null ? !ticketCategory.equals(that.ticketCategory) : that.ticketCategory != null)
            return false;

        return true;
    }

    @Override
    public int hashCode() {
        int result = show != null ? show.hashCode() : 0;
        result = 31 * result + (section != null ? section.hashCode() : 0);
        result = 31 * result + (ticketCategory != null ? ticketCategory.hashCode() : 0);
        return result;
    }

    @Override
    public String toString() {
        return "$ " + price + " for " + ticketCategory + " in " + section;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_performances">Performances</h3>
<div class="paragraph">
<p>Finally, let&#8217;s create the <code>Performance</code> class, which represents an instance of a <code>Show</code>. Performance is pretty straightforward. It contains the date and time of the performance, and the show of which it is a performance. Together, the show, and the date and time, make up the natural identity of the performance. Here&#8217;s the source for <code>Performance</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Performance.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">/**
 * &lt;p&gt;
 * A performance represents a single instance of a show.
 * &lt;/p&gt;
 *
 * &lt;p&gt;
 * The show and date form the natural id of this entity, and therefore must be unique. JPA requires us to use the class level
 * &lt;code&gt;@Table&lt;/code&gt; constraint.
 * &lt;/p&gt;
 *
 */
@SuppressWarnings("serial")
@Entity
@Table(uniqueConstraints = @UniqueConstraint(columnNames = { "date", "show_id" }))
public class Performance implements Serializable {

    /* Declaration of fields */

    /**
     * The synthetic id of the object.
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * &lt;p&gt;
     * The date and start time of the performance.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * A Java {@link Date} object represents both a date and a time, whilst an RDBMS splits out Date, Time and Timestamp.
     * Therefore we instruct JPA to store this date as a timestamp using the &lt;code&gt;@Temporal(TIMESTAMP)&lt;/code&gt; annotation.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The date and time of the performance is required, and the Bean Validation constraint &lt;code&gt;@NotNull&lt;/code&gt; enforces this.
     * &lt;/p&gt;
     */
    @Temporal(TIMESTAMP)
    @NotNull
    private Date date;

    /**
     * &lt;p&gt;
     * The show of which this is a performance. The &lt;code&gt;@ManyToOne&lt;code&gt; JPA mapping establishes this relationship.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The show of which this is a performance is required, and the Bean Validation constraint &lt;code&gt;@NotNull&lt;/code&gt; enforces
     * this.
     * &lt;/p&gt;
     */
    @ManyToOne
    @NotNull
    private Show show;

    /* Boilerplate getters and setters */

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public void setShow(Show show) {
        this.show = show;
    }

    public Show getShow() {
        return show;
    }

    public Date getDate() {
        return date;
    }

    public void setDate(Date date) {
        this.date = date;
    }

    /* equals() and hashCode() for Performance, using the natural identity of the object */

    @Override
    public boolean equals(Object o) {
        if (this == o)
            return true;
        if (o == null || getClass() != o.getClass())
            return false;

        Performance that = (Performance) o;

        if (date != null ? !date.equals(that.date) : that.date != null)
            return false;
        if (show != null ? !show.equals(that.show) : that.show != null)
            return false;

        return true;
    }

    @Override
    public int hashCode() {
        int result = date != null ? date.hashCode() : 0;
        result = 31 * result + (show != null ? show.hashCode() : 0);
        return result;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of interest here is the storage of the date and time.</p>
</div>
<div class="paragraph">
<p>A Java <code>Date</code> represents "a specific instance in time, with millisecond precision" and is the recommended construct for representing date and time in the JDK. A RDBMS&#8217;s <em>DATE</em> type typically has day precision only, and uses the <em>DATETIME</em> or <em>TIMESTAMP</em> types to represent an instance in time, and often only to second precision.</p>
</div>
<div class="paragraph">
<p>As the mapping between Java date and time, and database date and time isn&#8217;t straightforward, JPA requires us to use the <code>@Temporal</code> annotation on any property of type <code>Date</code>, and to specify whether the <code>Date</code> should be stored as a date, a time or a timestamp (date and time).</p>
</div>
</div>
<div class="sect2">
<h3 id="_booking_ticket_seat">Booking, Ticket &amp; Seat</h3>
<div class="paragraph">
<p>There aren&#8217;t many new concepts to explore in <code>Booking</code>, <code>Ticket</code> and <code>Seat</code>, so if you are following along with the tutorial, you should copy in the <code>Booking</code>, <code>Ticket</code> and <code>Seat</code> classes.</p>
</div>
<div class="paragraph">
<p>Once the user has selected an event, identified the venue, and selected a performance, they have the opportunity to request a number of seats in a given section, and select the category of tickets required. Once they&#8217;ve chosen their seats, and entered their email address, a <code>Booking</code> is created.</p>
</div>
<div class="paragraph">
<p>A booking consists of the date the booking was created, an email address (as TicketMonster doesn&#8217;t yet have fully fledged user management), a set of tickets and the associated performance. The set of tickets shows us how to create a uni-directional one-to-many relationship:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/Booking.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">    ...

    /**
     * &lt;p&gt;
     * The set of tickets contained within the booking. The &lt;code&gt;@OneToMany&lt;code&gt; JPA mapping establishes this relationship.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * The set of tickets is eagerly loaded because FIXME . All operations are cascaded to each ticket, so for example if a
     * booking is removed, then all associated tickets will be removed.
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * This relationship is uni-directional, so we need to inform JPA to create a foreign key mapping. The foreign key mapping
     * is not visible in the {@link Ticket} entity despite being present in the database.
     * &lt;/p&gt;
     *
     */
    @OneToMany(fetch = EAGER, cascade = ALL)
    @JoinColumn
    @NotEmpty
    @Valid
    private Set&lt;Ticket&gt; tickets = new HashSet&lt;Ticket&gt;();

    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>We add the <code>@JoinColumn</code> annotation, which sets up a foreign key in <code>Ticket</code>, but doesn&#8217;t expose the booking on Ticket. This prevents the use of messy mapping tables, whilst preserving the integrity of the entity model.</p>
</div>
<div class="paragraph">
<p>A ticket embeds the seat allocated, and contains a reference to the category under which it was sold. It also contains the price at which it was sold.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sectionallocation_and_seatallocationexception">SectionAllocation and SeatAllocationException</h3>
<div class="paragraph">
<p>Finally, we&#8217;d like to track the seats to be allocated from a section during the course of booking tickets. We&#8217;ll use the <code>SectionAllocation</code> entity to track the allocations in every section for every performance. You can copy in the <code>SectionAllocation</code> class from the project sources.</p>
</div>
<div class="paragraph">
<p>The notable member in this class is the two-dimensional array, named <code>allocated</code>. It tracks the state of the section - the first dimension represents the rows in the section, and the second represents the state of every seat in the row. A typical RDBMS would have to store such a structure as a LOB (Large Object) or a BLOB (Binary Large Object), since a n-dimensional array does not map easily to a native data type supported by the database. Thus, we denote the field as a <code>@Lob</code> using the JPA annotation:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/jboss/examples/ticketmonster/model/SectionAllocation.java</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">    ...

    @Lob
    private long[][] allocated;

    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rest of the class contains business logic to update the state of the <code>allocated</code> field. These methods will come in handy later, when we write the business services.</p>
</div>
<div class="paragraph">
<p>Remember to also copy the <code>SeatAllocationException</code> class, that is referenced in this class, from the project sources. This class represents an Application exception that will be recognized by the EJB container as one that should force a transaction rollback. When this exception is thrown by the business logic in the <code>SectionAllocation</code> entity, and propagated to the EJB container, it will implcitly cause the current transaction to roll back. It is to be noted that, this exception class is not a checked exception (it extends <code>RuntimeException</code>), and thus the compiler does not complain when it is uncaught in the business services that will consume the methods in the <code>SectionAllocation</code> entity.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connecting_to_the_database">Connecting to the database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this example, we are using the in-memory H2 database, which is very easy to set up on JBoss AS. JBoss AS allows you deploy a datasource inside your application&#8217;s <code>WEB-INF</code> directory. You can locate the source in <code>src/main/webapp/WEB-INF/ticket-monster-ds.xml</code> (which should have been created in the previous chapter):</p>
</div>
<div class="listingblock">
<div class="title">src/main/webapp/WEB-INF/ticket-monster-ds.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;datasources xmlns="http://www.jboss.org/ironjacamar/schema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.jboss.org/ironjacamar/schema http://docs.jboss.org/ironjacamar/schema/datasources_1_0.xsd"&gt;
    &lt;!-- The datasource is bound into JNDI at this location. We reference
        this in META-INF/persistence.xml --&gt;
    &lt;datasource jndi-name="java:jboss/datasources/ticket-monsterDS"
        pool-name="ticket-monster" enabled="true" use-java-context="true"&gt;
        &lt;connection-url&gt;
            jdbc:h2:mem:ticket-monster;DB_CLOSE_ON_EXIT=FALSE;DB_CLOSE_DELAY=-1
        &lt;/connection-url&gt;
        &lt;driver&gt;h2&lt;/driver&gt;
        &lt;security&gt;
            &lt;user-name&gt;sa&lt;/user-name&gt;
            &lt;password&gt;sa&lt;/password&gt;
        &lt;/security&gt;
    &lt;/datasource&gt;
&lt;/datasources&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The datasource configures an H2 in-memory database, called <em>ticket-monster</em>, and registers a datasource in JNDI at the address:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>java:jboss/datasources/ticket-monsterDS</pre>
</div>
</div>
<div class="paragraph">
<p>Now we need to configure JPA to use the datasource. This is done in <code>src/main/resources/META-INF/persistence.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/persistence.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;persistence version="2.0"
   xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="
        http://java.sun.com/xml/ns/persistence
        http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"&gt;
   &lt;persistence-unit name="primary"&gt;
      &lt;!-- If you are running in a production environment, add a managed
         data source, this example data source is just for development and testing! --&gt;
      &lt;!-- The datasource is deployed as WEB-INF/ticket-monster-ds.xml, you
         can find it in the source at src/main/webapp/WEB-INF/ticket-monster-ds.xml --&gt;
      &lt;jta-data-source&gt;java:jboss/datasources/ticket-monsterDS&lt;/jta-data-source&gt;
      &lt;properties&gt;
         &lt;!-- Properties for Hibernate --&gt;
         &lt;property name="hibernate.hbm2ddl.auto" value="create-drop" /&gt;
         &lt;property name="hibernate.show_sql" value="false" /&gt;
      &lt;/properties&gt;
   &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As our application has only one datasource, and hence one persistence unit, the name given to the persistence unit doesn&#8217;t really matter. We call ours <code>primary</code>, but you can change this as you like. We tell JPA about the datasource bound in JNDI.</p>
</div>
<div class="paragraph">
<p>Hibernate includes the ability to generate tables from entities, which we have configured here. We don&#8217;t recommend using this outside of development. Updates to databases in production should be done in a staged manner by a database administrator.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_populating_test_data">Populating test data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Whilst we develop our application, it&#8217;s useful to be able to populate the database with test data. Luckily, Hibernate makes this easy. Just add a file called <code>import.sql</code> onto the classpath of your application (we keep it in <code>src/main/resources/import.sql</code>). In it, we just write standard sql statements suitable for the database we are using. To do this, you need to know the generated column and table names for your entities. The best way to work these out is to look at the h2console.</p>
</div>
<div class="paragraph">
<p>The h2console is included in the JBoss AS quickstarts, along with instructions on how to use it. For more information, see <a href="http://www.jboss.org/quickstarts/eap/h2-console/" class="bare">http://www.jboss.org/quickstarts/eap/h2-console/</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Where do I look for my data?</div>
<div class="paragraph">
<p>The database URL is <code>jdbc:h2:mem:ticket-monster</code>. After
you have downloaded <code>h2console.war</code> and deployed it on the server, make sure that the
application is running on the server and use this value to connect to your running application&#8217;s
database.</p>
</div>
<div id="h2console_settings" class="imageblock">
<div class="content">
<img src="gfx/h2console_settings.png" alt="h2console settings">
</div>
<div class="title">Figure 4. h2console settings</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should copy over the <code>import.sql</code> file from the project sources, to populate the database with the same data, as the one used in the OpenShift-hosted TicketMonster application. The contents of this file already account for the generated table and column names.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You now have a working data model for your TicketMonster application, our next tutorial will show you how to create the business services layer or something like that - it seems to end abruptly.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-03-04 07:05:48 -0500
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>